<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>日本語読解</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;500&display=swap');

        :root {
            --bg-color: #fdfaf5;
            --paper-color: #ffffff;
            --text-color: #2c2c2c;
            --accent-color: #b33e3e; 
            --sub-color: #787878;
            --popup-bg: #333333;
            --chinese-font: "Microsoft YaHei", "PingFang SC", sans-serif;
            --japanese-font: 'Noto Serif JP', serif;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: var(--japanese-font);
            margin: 0;
            padding: 100px 15px 60px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* 顶部控制栏 */
        .top-bar {
            position: fixed; top: 0; left: 0; right: 0;
            height: 60px; background: rgba(253, 250, 245, 0.95);
            backdrop-filter: blur(8px);
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 25px; z-index: 1000;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        #today-date { font-size: 0.85rem; color: var(--accent-color); font-weight: 500; border-bottom: 1px solid; }
        .toggle-btn {
            background: white; color: var(--accent-color); border: 1px solid var(--accent-color);
            padding: 6px 14px; border-radius: 20px; font-size: 0.8rem;
            font-family: var(--chinese-font); cursor: pointer; transition: 0.3s;
        }
        .toggle-btn:hover { background: var(--accent-color); color: white; }

        /* 主容器 */
        .container {
            max-width: 720px; width: 100%;
            background: var(--paper-color); padding: 50px 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            box-sizing: border-box;
        }

        .header-title { text-align: center; margin-bottom: 50px; }
        .reading-block { margin-bottom: 45px; position: relative; }

        p.japanese {
            font-size: 1.15rem; line-height: 2.8; 
            text-align: justify; margin: 0;
        }

        ruby rt { font-size: 0.55em; color: var(--sub-color); letter-spacing: 0; }

        /* 译文（黑体中文） */
        .translation {
            display: none; margin-top: 20px; font-size: 0.95rem;
            color: #5a626b; line-height: 1.8; padding: 18px 20px;
            background-color: #f7f8f9; font-family: var(--chinese-font);
            border-left: 3px solid #eee; text-align: justify;
        }
        .translation::before { content: "訳"; display: block; font-size: 0.7rem; color: #ccc; margin-bottom: 5px; font-weight: bold; }

        /* 重点词汇样式 */
        .vocab-word {
            color: var(--accent-color);
            border-bottom: 2px solid #f2d0d0;
            cursor: pointer;
            font-weight: 500;
        }

        /* 动态气泡容器 */
        #smart-tooltip {
            position: absolute; z-index: 2000;
            background: var(--popup-bg); color: white;
            padding: 12px 16px; border-radius: 8px;
            font-size: 0.85rem; font-family: var(--chinese-font);
            line-height: 1.6; max-width: 280px; min-width: 140px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none; opacity: 0; pointer-events: none;
        }
        #smart-tooltip::after {
            content: ""; position: absolute; top: 100%;
            border: 8px solid transparent; border-top-color: var(--popup-bg);
        }

        .footer { margin-top: 50px; color: #ccc; font-size: 0.8rem; letter-spacing: 3px; }

        /* 音频播放器样式 */
        .audio-player-container {
            width: 100%;
            max-width: 600px;
            margin: 0 auto 40px;
            background: #fff;
            border: 1px solid rgba(179, 62, 62, 0.15);
            border-radius: 50px;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
            box-sizing: border-box;
        }

        .play-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--accent-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            transition: transform 0.2s, background 0.2s;
            padding: 0;
        }

        .play-btn:hover { background: #c64747; }
        .play-btn:active { transform: scale(0.95); }

        .play-icon {
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 7px 0 7px 11px;
            border-color: transparent transparent transparent white;
            margin-left: 3px;
        }

        .pause-icon {
            width: 10px;
            height: 14px;
            display: flex;
            justify-content: space-between;
        }

        .pause-icon span {
            width: 3px;
            height: 100%;
            background: white;
            border-radius: 2px;
        }

        .progress-container {
            flex-grow: 1;
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            cursor: pointer;
            position: relative;
            padding: 4px 0; /* 增加点击区域 */
        }

        .progress-bar-bg {
            height: 4px;
            background: #f0f0f0;
            border-radius: 2px;
            width: 100%;
            position: absolute;
            top: 4px;
        }

        .progress-bar {
            height: 4px;
            background: var(--accent-color);
            border-radius: 2px;
            width: 0%;
            position: absolute;
            top: 4px;
            pointer-events: none;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: var(--accent-color);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
            box-shadow: 0 0 4px rgba(0,0,0,0.2);
        }

        .progress-container:hover .progress-bar::after { opacity: 1; }

        .time-display {
            font-family: var(--chinese-font);
            font-size: 0.75rem;
            color: var(--sub-color);
            min-width: 80px;
            text-align: right;
            font-variant-numeric: tabular-nums;
            letter-spacing: 0.5px;
        }
    </style>
</head>
<body>

<div class="top-bar">
    <!-- 左侧返回按钮 -->
    <a href="../read.html" class="toggle-btn" style="text-decoration: none; margin-right: 15px;">← 戻る</a>
    
    <!-- 日期显示（可加 flex-grow 让它占据中间位置，或者保持原样） -->
    <div id="today-date" style="flex-grow: 1; text-align: center; border-bottom: none;">2026年2月24日 火曜日</div>
    
    <button class="toggle-btn" onclick="toggleTranslation()">訳文を表示/非表示</button>
</div>

<div class="container">
   <div class="header-title">
    <h2 style="font-weight: 500; letter-spacing: 0.1em; margin-bottom: 5px;">秘密計画</h2>
    <span style="color: #bbb; font-size: 0.8rem;">秘密计划</span>
</div>

    <!-- 音频播放器 -->
    <div class="audio-player-container">
        <!-- 
            请将音频文件放入 "../audio·read/" 文件夹中
            并将下方的 src 修改为具体的文件名，例如：src="../audio·read/lesson1.mp3"
        -->
        <audio id="audio-element" src="../audio_read/2.24.mp3" preload="metadata"></audio>
        
        <button class="play-btn" id="play-btn" title="再生/一時停止">
            <div class="play-icon"></div>
        </button>
        
        <div class="progress-container" id="progress-container">
            <div class="progress-bar-bg"></div>
            <div class="progress-bar" id="progress-bar"></div>
        </div>
        
        <div class="time-display">
            <span id="current-time">00:00</span> / <span id="duration">00:00</span>
        </div>
    </div>

    <div class="reading-block">
    <p class="japanese">
        <ruby>半<rt>はん</rt></ruby><ruby>年<rt>とし</rt></ruby>が<ruby>経<rt>た</rt></ruby>ったのでもういいだろうと<ruby>告<rt>こく</rt></ruby><ruby>白<rt>はく</rt></ruby>すると、<ruby>昨<rt>さく</rt></ruby><ruby>秋<rt>しゅう</rt></ruby>、<ruby>人<rt>じん</rt></ruby><ruby>生<rt>せい</rt></ruby><ruby>初<rt>はつ</rt></ruby>の<ruby>入<rt>にゅう</rt></ruby><ruby>院<rt>いん</rt></ruby>・<ruby>開<rt>かい</rt></ruby><ruby>腹<rt>ふく</rt></ruby><ruby>手<rt>しゅ</rt></ruby><ruby>術<rt>じゅつ</rt></ruby>を<ruby>経<rt>けい</rt></ruby><ruby>験<rt>けん</rt></ruby>した。<ruby>命<rt>いのち</rt></ruby>に<ruby>関<rt>かか</rt></ruby>わる<ruby>病<rt>びょう</rt></ruby><ruby>気<rt>き</rt></ruby>ではない。<span class="vocab-word" data-info="予後（よご）：预后，病后的恢复情况。"><ruby>予<rt>よ</rt></ruby><ruby>後<rt>ご</rt></ruby></span>も<ruby>順<rt>じゅん</rt></ruby><ruby>調<rt>ちょう</rt></ruby>で、<span class="vocab-word" data-info="もはや：已经，事到如今。（后接否定）不再。">もはや</span><ruby>傷<rt>きず</rt></ruby><ruby>跡<rt>あと</rt></ruby>さえ<ruby>見<rt>み</rt></ruby>なければ、それと<ruby>分<rt>わ</rt></ruby>からぬほどの<ruby>健<rt>けん</rt></ruby><ruby>康<rt>こう</rt></ruby><ruby>体<rt>たい</rt></ruby>だ。
    </p>
    <div class="translation">
        既然已经过去半年了，说出来应该也无妨了吧。去年秋天，我经历了人生中第一次住院和开腹手术。好在并不是什么危及生命的疾病。术后恢复得也很顺利，现在只要不看伤疤，我已经是个完全看不出动过手术的健康人了。
    </div>
</div>

<div class="reading-block">
    <p class="japanese">
        ただ<ruby>緊<rt>きん</rt></ruby><ruby>急<rt>きゅう</rt></ruby><ruby>事<rt>じ</rt></ruby><ruby>態<rt>たい</rt></ruby><ruby>宣<rt>せん</rt></ruby><ruby>言<rt>げん</rt></ruby>こそ<ruby>解<rt>かい</rt></ruby><ruby>除<rt>じょ</rt></ruby>されていたが、コロナ<ruby>禍<rt>か</rt></ruby><span class="vocab-word" data-info="真っただ中（まっただなか）：正中间，正处于...的高潮。"><ruby>真<rt>ま</rt></ruby>っただ<ruby>中<rt>なか</rt></ruby></span>の<ruby>入<rt>にゅう</rt></ruby><ruby>院<rt>いん</rt></ruby>である。<ruby>見<rt>み</rt></ruby><ruby>舞<rt>ま</rt></ruby>いはもちろん、<ruby>手<rt>しゅ</rt></ruby><ruby>術<rt>じゅつ</rt></ruby><ruby>中<rt>ちゅう</rt></ruby>の<ruby>家<rt>か</rt></ruby><ruby>族<rt>ぞく</rt></ruby>の<ruby>待<rt>たい</rt></ruby><ruby>機<rt>き</rt></ruby>すら<ruby>許<rt>きょ</rt></ruby><ruby>可<rt>か</rt></ruby>されず、<ruby>術<rt>じゅつ</rt></ruby><ruby>後<rt>ご</rt></ruby>の<ruby>説<rt>せつ</rt></ruby><ruby>明<rt>めい</rt></ruby>もドクターから<ruby>電<rt>でん</rt></ruby><ruby>話<rt>わ</rt></ruby>で<ruby>家<rt>か</rt></ruby><ruby>族<rt>ぞく</rt></ruby>に<ruby>行<rt>おこな</rt></ruby>われるような<ruby>状<rt>じょう</rt></ruby><ruby>況<rt>きょう</rt></ruby>だ。そのため<ruby>入<rt>にゅう</rt></ruby><ruby>院<rt>いん</rt></ruby>が<ruby>決<rt>き</rt></ruby>まると、<ruby>私<rt>わたし</rt></ruby>は「<ruby>家<rt>か</rt></ruby><ruby>族<rt>ぞく</rt></ruby>とごく<ruby>親<rt>した</rt></ruby>しい<ruby>人<rt>ひと</rt></ruby><ruby>以<rt>い</rt></ruby><ruby>外<rt>がい</rt></ruby>には、<ruby>当<rt>とう</rt></ruby><ruby>分<rt>ぶん</rt></ruby><ruby>内<rt>ない</rt></ruby><ruby>緒<rt>しょ</rt></ruby>にしよう」と<ruby>決<rt>き</rt></ruby>めた。<ruby>特<rt>とく</rt></ruby>に<ruby>仕<rt>し</rt></ruby><ruby>事<rt>ごと</rt></ruby><ruby>先<rt>さき</rt></ruby>の<ruby>方<rt>かた</rt></ruby><ruby>々<rt>がた</rt></ruby>は、<ruby>入<rt>にゅう</rt></ruby><ruby>院<rt>いん</rt></ruby>・<ruby>手<rt>しゅ</rt></ruby><ruby>術<rt>じゅつ</rt></ruby>と<ruby>聞<rt>き</rt></ruby>けば、お<ruby>約<rt>やく</rt></ruby><ruby>束<rt>そく</rt></ruby>の<span class="vocab-word" data-info="締切（しめきり）：截止日期，截稿日。"><ruby>締<rt>しめ</rt></ruby><ruby>切<rt>きり</rt></ruby></span>が<ruby>無<rt>む</rt></ruby><ruby>事<rt>じ</rt></ruby>に<ruby>守<rt>まも</rt></ruby>られるか、<span class="vocab-word" data-info="さぞ：想必，一定。">さぞ</span><ruby>心<rt>しん</rt></ruby><ruby>配<rt>ぱい</rt></ruby>なさるはず。どうせ<ruby>会<rt>あ</rt></ruby>えないご<span class="vocab-word" data-info="時世（じせい）：时代，世道。"><ruby>時<rt>じ</rt></ruby><ruby>世<rt>せい</rt></ruby></span>、<ruby>懸<rt>け</rt></ruby><ruby>念<rt>ねん</rt></ruby>を<ruby>増<rt>ふ</rt></ruby>やすだけなら<ruby>黙<rt>だま</rt></ruby>っておいた<ruby>方<rt>ほう</rt></ruby>がいいと<ruby>考<rt>かんが</rt></ruby>えた。
    </p>
    <div class="translation">
        只是，虽然当时紧急事态宣言已经解除，但住院毕竟还是在新冠疫情正严重的时候。别说探病了，就连手术期间都不允许家属在医院等候，术后的情况说明也是医生通过电话向家属交代的。因此，确定要住院后，我便暗下决心：“除了家人和极其亲近的朋友，暂时对其他人保密吧。”特别是工作上的合作方，要是听说我住院动手术，肯定会非常担心我能否顺利赶上交稿的截稿日。在这个反正也见不到面的特殊时期，如果说出来只会徒增他们的担忧，那还不如保持沉默。
    </div>
</div>

<div class="reading-block">
    <p class="japanese">
        <ruby>当<rt>とう</rt></ruby><ruby>時<rt>じ</rt></ruby>は<ruby>新<rt>しん</rt></ruby><ruby>聞<rt>ぶん</rt></ruby>の<ruby>連<rt>れん</rt></ruby><ruby>載<rt>さい</rt></ruby><ruby>小<rt>しょう</rt></ruby><ruby>説<rt>せつ</rt></ruby>を<ruby>抱<rt>かか</rt></ruby>えていたので、<ruby>仕<rt>し</rt></ruby><ruby>事<rt>ごと</rt></ruby>を<ruby>完<rt>かん</rt></ruby><ruby>全<rt>ぜん</rt></ruby>に<ruby>手<rt>て</rt></ruby><ruby>放<rt>ばな</rt></ruby>せはしない。ノートパソコンを<ruby>持<rt>も</rt></ruby>ち<ruby>込<rt>こ</rt></ruby>んでも、<ruby>手<rt>しゅ</rt></ruby><ruby>術<rt>じゅつ</rt></ruby><ruby>日<rt>び</rt></ruby>から<ruby>翌<rt>よく</rt></ruby>々<ruby>日<rt>じつ</rt></ruby>までは<ruby>身<rt>み</rt></ruby><ruby>動<rt>うご</rt></ruby>きできまいから、まずは<ruby>三<rt>みっ</rt></ruby><ruby>日<rt>か</rt></ruby><ruby>間<rt>かん</rt></ruby><ruby>連<rt>れん</rt></ruby><ruby>絡<rt>らく</rt></ruby>がつかなくても<ruby>大<rt>だい</rt></ruby><ruby>丈<rt>じょう</rt></ruby><ruby>夫<rt>ぶ</rt></ruby>なよう<ruby>調<rt>ちょう</rt></ruby><ruby>整<rt>せい</rt></ruby>して<ruby>入<rt>にゅう</rt></ruby><ruby>院<rt>いん</rt></ruby>した。しかし、である。
    </p>
    <div class="translation">
        当时我手里还负责着报纸的连载小说，所以不可能完全放下工作。尽管我把笔记本电脑带进了病房，但从手术当天到术后第三天估计是动弹不得的，所以我事先做好了统筹安排，确保即使有三天联系不上我也没有大碍，这才住进了医院。然而，意外还是发生了。
    </div>
</div>

<div class="reading-block">
    <p class="japanese">
        <ruby>手<rt>しゅ</rt></ruby><ruby>術<rt>じゅつ</rt></ruby>を<ruby>終<rt>お</rt></ruby>え、まだ<ruby>麻<rt>ま</rt></ruby><ruby>酔<rt>すい</rt></ruby>で<span class="vocab-word" data-info="朦朧（もうろう）：朦胧，意识不清。"><ruby>朦<rt>もう</rt></ruby><ruby>朧<rt>ろう</rt></ruby></span>としている<ruby>私<rt>わたし</rt></ruby>に、「ご<ruby>家<rt>か</rt></ruby><ruby>族<rt>ぞく</rt></ruby>に<ruby>電<rt>でん</rt></ruby><ruby>話<rt>わ</rt></ruby>していいですよ」と<ruby>看<rt>かん</rt></ruby><ruby>護<rt>ご</rt></ruby><ruby>師<rt>し</rt></ruby>さんがスマホを<ruby>持<rt>も</rt></ruby>たせてくれた。<span class="vocab-word" data-info="半ば（なかば）：一半，半途。"><ruby>半<rt>なか</rt></ruby>ば</span><ruby>眠<rt>ねむ</rt></ruby>った<ruby>状<rt>じょう</rt></ruby><ruby>態<rt>たい</rt></ruby>で<ruby>電<rt>でん</rt></ruby><ruby>話<rt>わ</rt></ruby>をかけて<ruby>寝<rt>ね</rt></ruby>ていると、おや、<ruby>着<rt>ちゃく</rt></ruby><ruby>信<rt>しん</rt></ruby>している。<ruby>家<rt>か</rt></ruby><ruby>族<rt>ぞく</rt></ruby>かな、<ruby>飼<rt>か</rt></ruby>い<ruby>猫<rt>ねこ</rt></ruby>の<ruby>声<rt>こえ</rt></ruby>を<ruby>聴<rt>き</rt></ruby>かせてくれるのかなと<ruby>出<rt>で</rt></ruby>れば、<span class="vocab-word" data-info="なんと：竟然，多么。表示惊讶。">なんと</span><ruby>入<rt>にゅう</rt></ruby><ruby>院<rt>いん</rt></ruby><ruby>直<rt>ちょく</rt></ruby><ruby>前<rt>ぜん</rt></ruby>に<ruby>原<rt>げん</rt></ruby><ruby>稿<rt>こう</rt></ruby>をやりとりした<ruby>編<rt>へん</rt></ruby><ruby>集<rt>しゅう</rt></ruby><ruby>者<rt>しゃ</rt></ruby>さんだ。<ruby>後<rt>ご</rt></ruby><ruby>日<rt>じつ</rt></ruby><ruby>尋<rt>たず</rt></ruby>ねれば、その<ruby>際<rt>さい</rt></ruby>の<ruby>私<rt>わたし</rt></ruby>があまりに<ruby>必<rt>ひっ</rt></ruby><ruby>死<rt>し</rt></ruby>に<ruby>見<rt>み</rt></ruby>えたので、<span class="vocab-word" data-info="案じる（あんじる）：（案じる的て形）担心，挂念。"><ruby>案<rt>あん</rt></ruby>じて</span>お<ruby>電<rt>でん</rt></ruby><ruby>話<rt>わ</rt></ruby>を<ruby>下<rt>くだ</rt></ruby>さったらしい。<ruby>仕<rt>し</rt></ruby><ruby>方<rt>かた</rt></ruby>なく<ruby>事<rt>じ</rt></ruby><ruby>情<rt>じょう</rt></ruby>を<ruby>明<rt>あ</rt></ruby>かし、<ruby>彼<rt>かの</rt></ruby><ruby>女<rt>じょ</rt></ruby>を<ruby>驚<rt>おどろ</rt></ruby>かせてしまったが、<span class="vocab-word" data-info="かくして：就这样，于是。">かくして</span><ruby>私<rt>わたし</rt></ruby>の<ruby>計<rt>けい</rt></ruby><ruby>画<rt>かく</rt></ruby>は<span class="vocab-word" data-info="脆い（もろい）：（脆い的连用形＋も）脆弱地，轻易地。">もろくも</span><ruby>二<rt>ふつ</rt></ruby><ruby>日<rt>か</rt></ruby><ruby>目<rt>め</rt></ruby>で<span class="vocab-word" data-info="瓦解（がかい）：瓦解，崩溃。"><ruby>瓦<rt>が</rt></ruby><ruby>解<rt>かい</rt></ruby></span>した。
    </p>
    <div class="translation">
        手术结束后，麻醉还没完全退去、意识尚且朦胧的我，被护士塞了部智能手机：“现在可以给家人打电话了哦。”我半睡半醒地打完电话正睡着，诶？有电话打进来了。是家里人吗？是想让我听听家里猫咪的叫声吗？我接起电话，没想到打来的竟然是住院前刚刚和我对接完稿件的编辑。后来我才知道，似乎是因为当时的我交稿时看起来太过拼命，她实在放心不下，才特意打电话来问候。我无奈之下只好向她说明了实情，着实把她吓了一跳。就这样，我的“保密计划”在第二天就脆弱地瓦解了。
    </div>
</div>

<div class="reading-block">
    <p class="japanese">
        ただそれ<ruby>以<rt>い</rt></ruby><ruby>来<rt>らい</rt></ruby>、<ruby>私<rt>わたし</rt></ruby>は<ruby>時<rt>とき</rt></ruby>々、<ruby>思<rt>おも</rt></ruby>う。<ruby>時<rt>とき</rt></ruby>に<ruby>我<rt>われ</rt></ruby>々は<ruby>人<rt>ひと</rt></ruby>に<ruby>会<rt>あ</rt></ruby>わないというだけで、<ruby>自<rt>じ</rt></ruby><ruby>分<rt>ぶん</rt></ruby>は<ruby>一<rt>ひと</rt></ruby><ruby>人<rt>り</rt></ruby>だと<ruby>考<rt>かんが</rt></ruby>えてしまう。だが<ruby>会<rt>あ</rt></ruby>えない<ruby>時<rt>とき</rt></ruby>も、<ruby>実<rt>じつ</rt></ruby>は<ruby>人<rt>ひと</rt></ruby>はひっそりと<ruby>誰<rt>だれ</rt></ruby>かとつながっており、<ruby>縁<rt>えん</rt></ruby>とは<ruby>目<rt>め</rt></ruby>に<ruby>見<rt>み</rt></ruby>える<ruby>瞬<rt>しゅん</rt></ruby><ruby>間<rt>かん</rt></ruby>だけが<ruby>全<rt>すべ</rt></ruby>てではないのだ、と。<span class="vocab-word" data-info="ならば：既然如此，那么。">ならば</span><ruby>人<rt>ひと</rt></ruby>と<ruby>会<rt>あ</rt></ruby>いづらい<ruby>今<rt>いま</rt></ruby>でもなお、<ruby>我<rt>われ</rt></ruby>々は<ruby>決<rt>けっ</rt></ruby>して<ruby>孤<rt>こ</rt></ruby><ruby>独<rt>どく</rt></ruby>ではない。そんなことに<ruby>気<rt>き</rt></ruby>づかされた<ruby>経<rt>けい</rt></ruby><ruby>験<rt>けん</rt></ruby>であった。
    </p>
    <div class="translation">
        不过自那以后，我时常会想：有时候，我们仅仅因为见不到人，就会觉得自己是孤身一人。但其实，即使在无法相见的日子里，人与人之间也在悄然相连。所谓的缘分，并非只有肉眼可见的瞬间才是全部。既然如此，即便是在如今这个难以相见的时期，我们也绝不是一座孤岛。这次的经历，让我深深地意识到了这一点。
    </div>
</div>
</div>

<div id="smart-tooltip"></div>

<div class="footer">Ichigo Ichie - 一期一会</div>

<script>
    // 1. (已移除) 实时日期逻辑 -> 改为在 HTML 中手动输入

    // 2. 译文切换
    function toggleTranslation() {
        document.querySelectorAll('.translation').forEach(el => {
            el.style.display = (el.style.display === 'block') ? 'none' : 'block';
        });
    }

    // 3. 智能自适应气泡逻辑
    const tooltip = document.getElementById('smart-tooltip');
    let activeWord = null;

    document.querySelectorAll('.vocab-word').forEach(word => {
        word.addEventListener('click', function(e) {
            e.stopPropagation();
            if (activeWord === this) { hideTooltip(); return; }

            activeWord = this;
            tooltip.innerText = this.getAttribute('data-info');
            tooltip.style.display = 'block';

            const rect = this.getBoundingClientRect();
            const tipRect = tooltip.getBoundingClientRect();
            const screenWidth = window.innerWidth;
            
            // 计算初始位置
            let left = rect.left + (rect.width / 2) - (tipRect.width / 2);
            let top = rect.top + window.scrollY - tipRect.height - 12;

            // 溢出检测与修正
            const margin = 15;
            let arrowOffset = '50%';

            if (left < margin) {
                left = margin;
                arrowOffset = (rect.left + rect.width/2 - margin) + 'px';
            } else if (left + tipRect.width > screenWidth - margin) {
                left = screenWidth - tipRect.width - margin;
                arrowOffset = (rect.left + rect.width/2 - left) + 'px';
            }

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';
            tooltip.style.opacity = '1';

            // 动态修正箭头位置
            const styleTag = document.getElementById('dynamic-arrow') || document.createElement('style');
            styleTag.id = 'dynamic-arrow';
            styleTag.innerHTML = `#smart-tooltip::after { left: ${arrowOffset} !important; transform: translateX(-50%); }`;
            document.head.appendChild(styleTag);
        });
    });

    function hideTooltip() {
        tooltip.style.opacity = '0';
        setTimeout(() => { tooltip.style.display = 'none'; }, 200);
        activeWord = null;
    }

    document.addEventListener('click', hideTooltip);
    window.addEventListener('resize', hideTooltip);

    // 4. 音频播放器逻辑
    const audio = document.getElementById('audio-element');
    const playBtn = document.getElementById('play-btn');
    const progressContainer = document.getElementById('progress-container');
    const progressBar = document.getElementById('progress-bar');
    const currentTimeEl = document.getElementById('current-time');
    const durationEl = document.getElementById('duration');
    let isPlaying = false;

    // 播放/暂停切换
    playBtn.addEventListener('click', () => {
        if (!audio.src || audio.src === window.location.href) {
            alert('音声ファイルが設定されていません。\n(音频文件未设置)');
            return;
        }
        
        if (isPlaying) {
            audio.pause();
        } else {
            audio.play();
        }
    });

    audio.addEventListener('play', () => {
        isPlaying = true;
        playBtn.innerHTML = '<div class="pause-icon"><span></span><span></span></div>';
    });

    audio.addEventListener('pause', () => {
        isPlaying = false;
        playBtn.innerHTML = '<div class="play-icon"></div>';
    });

    audio.addEventListener('ended', () => {
        isPlaying = false;
        playBtn.innerHTML = '<div class="play-icon"></div>';
        progressBar.style.width = '0%';
        currentTimeEl.textContent = '00:00';
    });

    // 更新进度条和时间
    audio.addEventListener('timeupdate', () => {
        const { currentTime, duration } = audio;
        if (isNaN(duration)) return;
        
        const progressPercent = (currentTime / duration) * 100;
        progressBar.style.width = `${progressPercent}%`;
        
        currentTimeEl.textContent = formatTime(currentTime);
        durationEl.textContent = formatTime(duration);
    });
    
    // 加载元数据时显示总时长
    audio.addEventListener('loadedmetadata', () => {
        if (!isNaN(audio.duration)) {
            durationEl.textContent = formatTime(audio.duration);
        }
    });

    // 点击进度条跳转
    progressContainer.addEventListener('click', (e) => {
        if (!audio.src || isNaN(audio.duration)) return;
        
        const rect = progressContainer.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const width = rect.width;
        const duration = audio.duration;
        
        audio.currentTime = (clickX / width) * duration;
    });

    // 时间格式化 helper
    function formatTime(seconds) {
        const min = Math.floor(seconds / 60);
        const sec = Math.floor(seconds % 60);
        return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
    }
</script>

</body>
</html>
