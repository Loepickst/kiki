<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>即時応答 - 聴解練習</title>
    <style>
        :root {
            /* --- 统一配色方案 --- */
            --bg-color: #fdfaf5;       /* 米色背景 */
            --paper-color: #ffffff;    /* 卡片背景 */
            --text-color: #2c2c2c;     /* 主文字 */
            --sub-color: #787878;      /* 辅助文字 */
            --accent-color: #b33e3e;   /* 强调色 (茜色) */
            --accent-light: #fbe9e7;   /* 强调色淡色背景 */
            --border-color: #e0e0e0;   /* 边框颜色 */
            --shadow: 0 4px 20px rgba(0,0,0,0.05); /* 柔和阴影 */
            
            /* 功能色 */
            --primary-btn: #2c3e50;
            --highlight-purple: #9c27b0;
        }

        body {
            font-family: "Hiragino Kaku Gothic ProN", "Hiragino Sans", "Meiryo", "Microsoft YaHei", -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0; /* Remove padding to accommodate full-width header */
            display: flex;
            flex-direction: column; /* Allow header to stack above container */
            align-items: center;
            min-height: 100vh;
        }

        /* Global Header Style */
        header {
            width: 100%;
            padding: 15px 20px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: rgba(253, 250, 245, 0.95);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
            margin-bottom: 40px;
        }

        header h1 {
            margin: 0;
            font-size: 18px;
            font-weight: 700;
            color: var(--text-color);
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
        }

        .back-btn {
            text-decoration: none;
            color: var(--text-color);
            font-size: 16px;
            font-weight: bold;
            opacity: 0.7;
            transition: opacity 0.3s;
            cursor: pointer;
            z-index: 2;
        }

        .back-btn:hover { opacity: 1; }

        /* 主容器 */
        .practice-container {
            margin-top: 20px; /* Add space below sticky header */
            margin-bottom: 40px;
            background: var(--paper-color);
            border-radius: 20px;
            max-width: 850px;
            width: 100%;
            padding: 50px;
            box-shadow: var(--shadow);
            border: 1px solid rgba(0,0,0,0.02);
            position: relative;
        }

        /* 顶部 Header */
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 35px;
            padding-bottom: 20px;
            border-bottom: 2px solid #f0f0f0;
        }

        .question-tag {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .question-tag::before {
            content: "";
            display: block;
            width: 6px;
            height: 24px;
            background-color: var(--accent-color);
            border-radius: 3px;
        }

        .question-meta {
            font-size: 14px;
            color: var(--sub-color);
            font-weight: normal;
            margin-left: 10px;
            background: #f5f5f5;
            padding: 4px 10px;
            border-radius: 4px;
        }

        /* 模式切换按钮优化 */
        .mode-switch {
            display: flex;
            background: #f0f0f0;
            padding: 4px;
            border-radius: 12px;
        }

        button {
            padding: 8px 16px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            color: #888;
            border-radius: 10px;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        button.active {
            background-color: #fff;
            color: var(--text-color);
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        /* 音频播放器区域 */
        .audio-section {
            margin-bottom: 40px;
            background: #fcfcfc;
            padding: 15px 25px;
            border-radius: 12px;
            border: 1px solid #f0f0f0;
        }

        .custom-audio-player {
            width: 100%;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .play-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--accent-color);
            color: white;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            flex-shrink: 0;
            transition: all 0.2s;
            padding: 0;
            box-shadow: 0 4px 10px rgba(179, 62, 62, 0.3);
        }
        
        .play-btn:hover {
            transform: scale(1.05);
            background: #d32f2f;
        }

        .progress-container {
            flex: 1;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            cursor: pointer;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            background: var(--accent-color);
            border-radius: 3px;
            width: 0%;
            position: relative;
            transition: width 0.1s linear;
        }
        
        .progress-bar::after {
            content: "";
            position: absolute;
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            width: 12px;
            height: 12px;
            background: #fff;
            border: 2px solid var(--accent-color);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s;
        }
        
        .progress-container:hover .progress-bar::after {
            opacity: 1;
        }

        .time-display {
            font-size: 12px;
            color: var(--sub-color);
            font-variant-numeric: tabular-nums;
            min-width: 80px;
            text-align: right;
            font-weight: 500;
        }

        /* 内容区布局 */
        .content-wrapper {
            display: flex;
            gap: 40px;
            align-items: flex-start;
        }

        /* 左侧图片 */
        .left-panel {
            flex: 0 0 300px;
        }

        .left-panel img {
            width: 100%;
            height: auto;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.06);
            display: block;
            border: 4px solid #fff;
        }

        /* 右侧面板 */
        .right-panel {
            flex: 1;
        }

        /* 练习模式下的样式优化 */
        .mode-practice .left-panel img {
            filter: blur(20px);
            transition: filter 0.5s ease;
        }

        .mode-practice.judged .left-panel img {
            filter: none;
        }

        .mode-practice .right-panel {
            /* 移除模糊，允许操作 */
            filter: none;
            opacity: 1;
            pointer-events: auto;
            user-select: auto;
            transition: all 0.5s ease;
        }

        /* 练习模式下隐藏文本内容 */
        .mode-practice .dialogue-block,
        .mode-practice .option-text,
        .mode-practice .translation {
            display: none !important;
        }

        /* 练习模式下显示选项占位符 */
        .mode-practice .options-list li::after {
            content: "選択肢";
            color: #ccc;
            font-weight: bold;
            font-size: 14px;
        }

        /* 练习模式下的选中状态 */
        .mode-practice .options-list li {
            cursor: pointer;
            min-height: 24px;
            display: flex;
            align-items: center;
        }
        
        .mode-practice .options-list li:hover {
            background-color: #f9f9f9;
        }

        .mode-practice .options-list li.selected {
            border-color: var(--primary-btn);
            background-color: #f0f8ff;
            box-shadow: 0 0 0 1px var(--primary-btn);
        }

        .mode-explanation .right-panel {
            filter: blur(0);
            opacity: 1;
            pointer-events: auto;
            transition: all 0.5s ease;
        }

        .mode-explanation .left-panel img {
            filter: none;
        }

        /* 对话区块优化 */
        .dialogue-block {
            margin-bottom: 30px;
            position: relative;
        }
        
        .dialogue-label {
            font-size: 12px;
            color: var(--accent-color);
            font-weight: bold;
            margin-bottom: 8px;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .dialogue-text {
            font-size: 16px;
            line-height: 1.8;
            color: var(--text-color);
            font-weight: 500;
        }

        .speaker-name {
            font-weight: bold;
            margin-right: 4px;
        }

        .translation {
            color: var(--sub-color);
            font-size: 13px;
            line-height: 1.6;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px dashed #eee;
            display: none;
        }

        .mode-explanation .translation { display: block; }

        /* 选项列表优化 */
        .options-list {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .options-list li {
            padding: 16px 20px;
            border-radius: 12px;
            border: 1px solid #eee;
            background: #fff;
            transition: all 0.2s ease;
            position: relative;
            padding-left: 45px; /* Space for number */
        }
        
        .mode-explanation .options-list li:hover {
            border-color: var(--accent-color);
            background-color: #fffafa;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.03);
        }

        .options-num {
            position: absolute;
            left: 12px;
            top: 17px; /* Aligned with text line-height */
            width: 18px;
            height: 18px;
            background: #f0f0f0;
            color: #666;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
        }

        .mode-explanation .correct-answer .options-num {
            background: var(--accent-color);
            color: #fff;
        }

        .mode-explanation .correct-answer {
            background-color: var(--accent-light);
            border-color: var(--accent-color);
        }
        
        .option-text {
            font-size: 14px;
            font-weight: 500;
            color: var(--text-color);
        }

        /* 关键词样式 */
        .keyword {
            color: var(--accent-color);
            border-bottom: 1px solid rgba(179, 62, 62, 0.3);
            cursor: pointer;
            font-weight: bold;
            padding: 0 2px;
            transition: all 0.2s;
        }

        .keyword:hover {
            background-color: var(--accent-light);
            border-bottom-color: var(--accent-color);
        }

        /* Tooltip */
        .custom-tooltip {
            position: absolute;
            background-color: #333;
            color: #fff;
            padding: 10px 14px;
            border-radius: 6px;
            font-size: 13px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            pointer-events: none;
            z-index: 1000;
            display: none;
            max-width: 260px;
            line-height: 1.6;
            --arrow-left: 50%;
        }
        .custom-tooltip::after {
            content: "";
            position: absolute;
            top: 100%; 
            left: var(--arrow-left);
            margin-left: -6px;
            border-width: 6px;
            border-style: solid;
            border-color: #333 transparent transparent transparent;
        }

        /* Header Controls */
        .header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .year-display {
            font-size: 16px;
            font-weight: bold;
            color: var(--text-color);
            background: #f5f5f5;
            padding: 8px 16px;
            border-radius: 8px;
        }
        
        .divider {
            font-size: 20px;
            color: #ddd;
            margin: 0 5px;
            font-weight: 300;
        }

        .question-select {
            padding: 8px 16px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fff;
            color: var(--text-color);
            outline: none;
            font-weight: bold;
            cursor: pointer;
            min-width: 120px;
        }

        .nav-controls {
            margin-top: 30px;
            display: flex;
            justify-content: space-between;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }

        .nav-btn {
            padding: 8px 20px;
            background: #f0f0f0;
            border: none;
            border-radius: 8px;
            color: #555;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }

        .nav-btn:hover:not(:disabled) {
            background: #e0e0e0;
            color: #333;
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Confirm Button */
        .confirm-btn {
            padding: 8px 24px;
            background-color: var(--primary-btn);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
        }
        .confirm-btn:hover {
            opacity: 0.9;
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(0,0,0,0.15);
        }

        /* Practice Mode Results */
        .mode-practice .options-list li.judged-correct {
            background-color: #e8f5e9 !important;
            border-color: #4caf50 !important;
            box-shadow: 0 0 0 1px #4caf50;
        }
        .mode-practice .options-list li.judged-correct::after {
            content: "正解" !important;
            color: #2e7d32 !important;
        }

        .mode-practice .options-list li.judged-wrong {
            background-color: #ffebee !important;
            border-color: #ef5350 !important;
            box-shadow: 0 0 0 1px #ef5350;
        }
        .mode-practice .options-list li.judged-wrong::after {
            content: "不正解" !important;
            color: #ef5350 !important;
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .practice-container {
                width: 95%;
                padding: 20px;
                margin-top: 20px;
            }
            .controls {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            .audio-player audio { width: 100%; }
            .mode-switch { justify-content: center; }
            .content-wrapper {
                flex-direction: column;
                gap: 20px;
                align-items: stretch;
            }
            .left-panel { flex: none; width: 100%; max-width: 320px; margin: 0 auto; }
            
            /* Mobile Font Adjustments */
            .question-tag { font-size: 18px; }
            .dialogue-text { font-size: 15px; }
            .option-text { font-size: 13px; }
            .translation { font-size: 12px; }

            /* Header Compact Mode for Mobile */
            .header-left { gap: 5px; }
            .year-display {
                font-size: 13px;
                padding: 6px 10px;
            }
            .divider { font-size: 16px; margin: 0 2px; }
            .question-select {
                font-size: 13px;
                padding: 6px 10px;
                min-width: auto;
            }
            .mode-switch button {
                font-size: 12px;
                padding: 6px 12px;
            }
            
            /* Mobile Option Number Alignment */
            .options-num {
                width: 16px;
                height: 16px;
                line-height: 16px;
                font-size: 11px;
                top: 18px; /* Keep aligned with text */
            }
            .options-list li {
                padding-left: 40px;
            }
        }
    </style>
</head>
<body>

    <header>
        <a href="N2_j.html" class="back-btn">← 戻る</a>
        <h1>即時応答 - 2010.7</h1>
    </header>

    <div class="practice-container mode-practice" id="appContainer">
        
        <div class="card-header">
            <div class="header-left">
                <div class="year-display" id="yearLabel"></div>
                <div class="divider">|</div>
                <select id="questionSelect" class="question-select" onchange="changeQuestion(this.value)">
                    <!-- Options populated by JS -->
                </select>
            </div>
            <div class="mode-switch">
                <button id="btnPractice" class="active" onclick="setMode('practice')">練習</button>
                <button id="btnExplanation" onclick="setMode('explanation')">解説</button>
            </div>
        </div>

        <div class="audio-section">
            <div class="custom-audio-player">
                <button class="play-btn" id="playBtn">
                    <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13 7.13397C14.3333 7.90377 14.3333 9.82823 13 10.598L2.5 16.6603C1.16667 17.4301 -1.45707e-06 16.4678 -1.38973e-06 14.9282L-8.59795e-07 2.80385C-7.92455e-07 1.26425 1.16667 0.301995 2.5 1.0718L13 7.13397Z" fill="white"/>
                    </svg>
                </button>
                <div class="progress-container" id="progressContainer">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <div class="time-display" id="timeDisplay">00:00 / 00:00</div>
                <audio id="audioElement" preload="metadata"></audio>
            </div>
        </div>

        <div class="content-wrapper">
            <div class="left-panel">
                <img src="" alt="对话场景" id="sceneImage" style="display: none;">
            </div>
            
            <div class="right-panel" id="rightPanel">
                <!-- Content populated by JS -->
                <div class="dialogue-block" id="dialogueBlock"></div>
                <ul class="options-list" id="optionsList"></ul>
                
                <div class="nav-controls">
                    <button id="prevBtn" class="nav-btn" onclick="prevQuestion()">← 前へ</button>
                    <button id="confirmBtn" class="confirm-btn" onclick="checkAnswer()" style="display: none;">確認</button>
                    <button id="nextBtn" class="nav-btn" onclick="nextQuestion()">次へ →</button>
                </div>
            </div>
        </div>
    </div>

    <div id="wordTooltip" class="custom-tooltip"></div>

    <script>
        // --- Data Structure ---
        const examData = {
            "2010-07": {
                label: "2010年7月",
                questions: [
                    {
                        id: 1,
                        audio: "audio_j/2010.7-1.mp3",
                        image: "image/2010.7-1.png",
                        dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">あ、台所の電球、<span class="keyword" onclick="showTooltip(event, '切れちゃった：\\n「てしまう」的口语缩略形式「ちゃう」的た形，表示发生了令人遗憾或麻烦的结果，这里指“灯泡坏掉了”。')">切れちゃった</span>よ。</span>`,
    translation: "（男：啊，厨房的灯泡坏了。）",
    options: [
        { text: "あっ、電気、もう消すね。", translation: "（啊，我关灯了哈。）", correct: false },
        { text: `えっ、新しいの、買って<span class="keyword" onclick="showTooltip(event, 'こなきゃ：\\n动词「くる」的ない形的口语表达。完整形式是「こなければならない」，表示“必须（买）回来”。')">こなきゃ</span>。`, translation: "（哎，要买新的了。）", correct: true },
        { text: "うん、台所、きれいにしてね。", translation: "（嗯，把厨房打扫干净吧。）", correct: false }
    ]
                    },
                    {
    id: 2,
    audio: "audio_j/2010.7-2.mp3",
    image: "image/2010.7-2.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">いらっしゃいませ。何か<span class="keyword" onclick="showTooltip(event, 'お探しですか：\\n动词「探す」的尊他语表达，表示对对方的尊敬。这里通过疑问的方式来询问对方是否在找什么。')">お探しですか</span>。</span>`,
    translation: "（欢迎光临。您在找什么吗？）",
    options: [
        { text: "あ、ちょっと見てるだけです。", translation: "（啊，我只是随便看看。）", correct: true },
        { text: `いいえ、さっき来<span class="keyword" onclick="showTooltip(event, 'たばかり：\\n接在动词「た形」后，表示动作刚刚发生或完成。')">たばかり</span>です。`, translation: "（不，我刚来。）", correct: false },
        { text: `はい、なんでも<span class="keyword" onclick="showTooltip(event, 'けっこう：\\n形容动词，表示“足够”、“可以”或婉拒。')">けっこう</span>です。`, translation: "（是的，什么都可以。）", correct: false }
    ]
},
{
    id: 3,
    audio: "audio_j/2010.7-3.mp3",
    image: "image/2010.7-3.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text"><span class="keyword" onclick="showTooltip(event, 'やるだけのことはやった：\\n这里使用了「动词原形＋だけ」的句式，表示“尽最大可能的限度”。结尾的「やった」是「やる」的た形，表示动作完成。\\n这句话本身的意思是“能做的努力都已经做了”，表示拼尽全力，没有遗憾了。')">やるだけのことはやった</span>し、<span class="keyword" onclick="showTooltip(event, 'あと〜だけ：\\n表示“剩下的事情就只有……了”。')">あと</span>は合格発表の日を待つ<span class="keyword" onclick="showTooltip(event, 'あと〜だけ：\\n表示“剩下的事情就只有……了”。')">だけ</span>だね。</span>`,
    translation: "（能做的都已经做了，接下来就只剩等合格发表的那一天了。）",
    options: [
        { text: "本当に悔しいね。", translation: "（真的好不甘心啊。）", correct: false },
        { text: "もう少し頑張るしかないか。", translation: "（看来只能再多加把劲了。）", correct: false },
        { text: `今度<span class="keyword" onclick="showTooltip(event, 'こそ：\\n表示强烈的强调，意思是“唯有这次”、“这次一定”。')">こそ</span>、受かりたいよね。`, translation: "（这一次一定要考上啊。）", correct: true }
    ]
},
{
    id: 4,
    audio: "audio_j/2010.7-4.mp3",
    image: "image/2010.7-4.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">あのう、お茶でも<span class="keyword" onclick="showTooltip(event, 'いかがですか：\\n「どうですか」的更为礼貌的说法，意为“怎么样”，常用于向对方提出建议或劝诱。')">いかがですか</span>。</span>`,
    translation: "（那个，要来点茶吗？）",
    options: [
        { text: `<span class="keyword" onclick="showTooltip(event, 'お世話になって：\\n「お世話になる」的て形，结合后面的「おります」构成了「ている形」的自谦形式，表示一直以来得到对方的关照。')">お世話になって</span>おります。`, translation: "（承蒙关照了。）", correct: false },
        { text: "はい、大変おいしかったです。", translation: "（嗯，非常好喝。）", correct: false },
        { text: `すみません。どうぞ<span class="keyword" onclick="showTooltip(event, 'お構いなく：\\n表示“请别张罗了”、“不用麻烦了”，常用于客气地婉拒别人主动提供的招待。')">おかまいなく</span>。`, translation: "（谢谢，不用这么客气。）", correct: true }
    ]
},
{
    id: 5,
    audio: "audio_j/2010.7-5.mp3",
    image: "image/2010.7-5.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">ねえ、山田さん、参加できないのなら、もう少し早く教えてくれ<span class="keyword" onclick="showTooltip(event, 'なくちゃ：\\「なくてはいけない」或「なくてはならない」的口语表达，表示“必须”。在这是暗示对方并没有做这件事，带有责备之意')">なくちゃ</span>。</span>`,
    translation: "（喂，山田先生，如果不能参加的话，得早点告诉我才行啊。）",
    options: [
        { text: "えっ、連絡が必要だったんだ。", translation: "（咦，还需要提前联系啊。）", correct: true },
        { text: `そう、<span class="keyword" onclick="showTooltip(event, '今度：\\n名词，表示“下次”、“这次”。')">今度</span>は教えてもらえる<span class="keyword" onclick="showTooltip(event, 'といい：\\n表示希望、愿望，意为“要是……就好了”。')">といい</span>ね。`, translation: "（是啊，希望下次能早点告诉我。）", correct: false },
        { text: "少しでも早く参加したかったんだ。", translation: "（我也想尽早参加的。）", correct: false }
    ]
},
{
    id: 6,
    audio: "audio_j/2010.7-6.mp3",
    image: "image/2010.7-6.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text"><span class="keyword" onclick="showTooltip(event, 'たしか：\\n副词，表示凭记忆进行推测，含有不太确定的语气，意思是“好像”、“记得”。')">たしか</span>、あした中学の時のクラス会だったよね。行く<span class="keyword" onclick="showTooltip(event, 'んでしょう：\\n「の」的口语形式「ん」加上推测表达「でしょう」，在这里用于向对方确认，意思是“……的吧”。')">んでしょう</span>。</span>`,
    translation: "（我记得好像明天是中学同学会吧？你会去的吧。）",
    options: [
        { text: `<span class="keyword" onclick="showTooltip(event, '楽しみにしてる：\\n「楽しみにする」（期待）加上表示状态的「ている形」的口语省略形式「てる」，意思是“一直期待着”。')">楽しみにしてる</span>んだ。`, translation: "（我正期待着呢。）", correct: true },
        { text: `<span class="keyword" onclick="showTooltip(event, '楽しんできて：\\n动词「楽しむ」的て形加上「くる」的て形，表示去做某事并回来，意思是“去好好享受一番吧”。这是给予对方的意见，而不是发表自身的情感。')">楽しんできて</span>ね。`, translation: "（祝你玩得开心。）", correct: false },
        { text: "たのしいでしょう。", translation: "（应该会很有趣吧。）", correct: false }
    ]
},
{
    id: 7,
    audio: "audio_j/2010.7-7.mp3",
    image: "image/2010.7-7.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">昨日、また電気、<span class="keyword" onclick="showTooltip(event, 'つけっぱなし：\\n动词「つける」的第一连用形加上「っぱなし」，表示某种状态一直持续，放置不管。这里意思是“一直开着”。')">つけっぱなし</span>で寝てたね。</span>`,
    translation: "（昨天你又开着灯睡着了呀。）",
    options: [
        { text: `<span class="keyword" onclick="showTooltip(event, 'つけておいて：\\n动词「つける」的て形加上「おく」的て形，表示事先做好准备或让某种状态保持下去。这里指“特意开着灯”。')">つけておいて</span>くれたんだね。ありがとう。`, translation: "（原来是特意留灯给我啊，谢谢。）", correct: false },
        { text: `<span class="keyword" onclick="showTooltip(event, 'だって：\\n多用于口语，用来为自己辩解或说明原因，意思是“因为……嘛”。')">だって</span>、暗い方が好きだから。`, translation: "（因为我喜欢黑着灯呀。）", correct: false },
        { text: "ごめん。本読んでて、寝ちゃったみたい。", translation: "（抱歉，看来是看书时不小心睡着了。）", correct: true }
    ]
},
{
    id: 8,
    audio: "audio_j/2010.7-8.mp3",
    image: "image/2010.7-8.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">さっき言ってた本、今度、貸し<span class="keyword" onclick="showTooltip(event, 'てもらえるとうれしい：\\n「てもらえる」是「てもらう」的能动态，表示“能得到（某人做某事）”。接上「と」和「うれしい」，表示“如果能……的话我会很高兴”，用于委婉地提出请求。')">てもらえるとうれしい</span><span class="keyword" onclick="showTooltip(event, 'んだけど：\\n「ん」是「の」的口语形式，用于说明情况；「だけど」用于铺垫。合起来用来引出话题或请求，使语气更委婉。')">んだけど</span>。</span>`,
    translation: "（你刚才提到的那本书，下次能借给我看看就好了。）",
    options: [
        { text: `<span class="keyword" onclick="showTooltip(event, 'こっちこそ：\\n「こっち」指自己这边；「こそ」表示强调。合起来表示“我才（应该……）”。')">こっちこそ</span>、助かったよ。`, translation: "（应该是我更得感谢你才对。）", correct: false },
        { text: `うん、忘れない<span class="keyword" onclick="showTooltip(event, 'ようにする：\\n接在动词基本形或「ない形」之后，表示为了达到某种状态或结果而主观上努力，意思是“尽量做到……”。')">ようにする</span>ね。`, translation: "（好，我会记得带来的。）", correct: true },
        { text: `じゃあ、<span class="keyword" onclick="showTooltip(event, '悪いけど：\\n口语中常用的客套话，意思是“不好意思，麻烦你了”，多用于拜托别人做事之前。')">悪いけど</span>、お願いね。`, translation: "（那就麻烦你啦。）", correct: false }
    ]
},
{
    id: 9,
    audio: "audio_j/2010.7-9.mp3",
    image: "image/2010.7-9.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">あのう、こちらで山田課長と<span class="keyword" onclick="showTooltip(event, 'お会いする：\\n「お＋动词第一连用形＋する」构成的自谦语，通过降低自己的动作来表示对对方的尊敬。这里指“我见（山田科长）”。')">お会いする</span>約束な<span class="keyword" onclick="showTooltip(event, 'んですが：\\n「ん」用于客观说明情况；「ですが」在这里不表转折，而是起铺垫作用，以缓和语气引出话头，暗示希望对方帮忙通报。')">んですが</span>。</span>`,
    translation: "（那个，我约好在这里见山田科长。）",
    options: [
        { text: "お会いできて、良かったです。", translation: "（很高兴能见到您。）", correct: false },
        { text: `はい、<span class="keyword" onclick="showTooltip(event, '少々：\\n副词，表示“稍微”、“一点点”，比「少し」更为郑重、礼貌，常用于商务或服务等正式场合。')">少々</span>お待ちください。`, translation: "（好的，请稍等。）", correct: true },
        { text: "確かにお約束いたします。", translation: "（我保证一定办到。）", correct: false }
    ]
},
{
    id: 10,
    audio: "audio_j/2010.7-10.mp3",
    image: "image/2010.7-10.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">ああ、田中さんのご主人ですか。初めまして。</span>`,
    translation: "（啊，您是田中女士的丈夫吗？初次见面。）",
    options: [
        { text: `大変<span class="keyword" onclick="showTooltip(event, 'ご無沙汰して：\\n「ご無沙汰する」的て形，意为“久疏问候”、“好久不见”，用于较长一段时间没有与对方联系时的客气表达。由于对话中提到是“初めまして（初次见面）”，因此该选项不符合语境。')">ご無沙汰して</span>おります。`, translation: "（真是好久不见了。）", correct: false },
        { text: "はい、相変わらずです。", translation: "（是的，老样子。）", correct: false },
        { text: "妻がお世話になっております。", translation: "（一直承蒙您照顾家内。）", correct: true }
    ]
},
{
    id: 11,
    audio: "audio_j/2010.7-11.mp3",
    image: "image/2010.7-11.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">きのうね、この角で、自転車にぶつかり<span class="keyword" onclick="showTooltip(event, 'そうになっちゃった：\\n「动词第一连用形＋そうになる」，表示事情眼看就要发生，意思是“差点儿就……”。「なっちゃった」是「なってしまった」的口语缩略形式，即「なる」的て形接上「てしまう」的口语形式「ちゃう」的た形，带有后怕或遗憾的语气。')">そうになっちゃった</span>んだ。</span>`,
    translation: "（昨天我在这个拐角差点撞上自行车了。）",
    options: [
        { text: `あぶないんだ<span class="keyword" onclick="showTooltip(event, 'よね：\\n句尾语气词「よ」表示主张或提醒对方注意，「ね」表示寻求对方的同意或同感。两者连在一起使用，表示在陈述自己感受的同时寻求对方的共鸣，意思是“……对吧”。')">よね</span>。ここ`, translation: "（这地方挺危险的啊。）", correct: true },
        { text: "ヘえ、痛かったでしょう。", translation: "（哎呀，那肯定很疼吧？）", correct: false },
        { text: "ここは問題ないよ。", translation: "（这儿没什么问题啦。）", correct: false }
    ]
},
{
    id: 12,
    audio: "audio_j/2010.7-12.mp3",
    image: "image/2010.7-12.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">君、<span class="keyword" onclick="showTooltip(event, 'なんてこと：\\n“多么（糟糕的）事情”。在这里带有强烈的责备和不满语气，指代对方犯下的严重错误。')">なんてこと</span>をし<span class="keyword" onclick="showTooltip(event, 'てくれた：\\て形加上「くれる」。虽然形式上表示“为我做某事”，但在这里是说反话，表示对方的行为给自己造成了极大的麻烦或损害。')">てくれた</span>んだ。</span>`,
    translation: "（看看你都干了些什么好事！）",
    options: [
        { text: `いいえ、<span class="keyword" onclick="showTooltip(event, 'とんでもない：\\n形容词，意为“没有的事”、“哪里的话”。多用于强烈否定对方的赞美以示谦虚，不能用于回应别人的责备。')">とんでもない</span>です。`, translation: "（哪里，哪敢当。）", correct: false },
        { text: `<span class="keyword" onclick="showTooltip(event, '恐縮：\\n名词或形容动词，表示“惶恐”、“过意不去”。常用于给别人添小麻烦或接受好意时的客套话，用来回应严厉的责备语境不符。')">恐縮</span>です。`, translation: "（太过意不去了）", correct: false },
        { text: "申し訳ございません。", translation: "（非常抱歉。）", correct: true }
    ]
}
                ]
            },
            "2010-12": {
                label: "2010年12月",
                questions: [
                    {
    id: 1,
    audio: "audio_j/2010.12-1.mp3",
    image: "image/2010.12-1.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">田中さん、次の会議ですが、いつがいいですか。</span>`,
    translation: "（田中先生，下一次会议什么时候合适？）",
    options: [
        { text: `じゃ、予定に入れ<span class="keyword" onclick="showTooltip(event, 'ときます：\\n「ておく」的口语缩略形式「とく」的ます形，表示事先做好某种准备。这里指“事先排进日程”。')">ときます</span>。`, translation: "（那我把它排进日程。）", correct: false },
        { text: `ああ、その日はちょっと<span class="keyword" onclick="showTooltip(event, '都合がつかない：\\n「都合がつく」的ない形，表示时间安排不开、不方便。')">都合がつかない</span>んですが。`, translation: "（啊，那天我不太方便。）", correct: false },
        { text: `火曜の午後なら、<span class="keyword" onclick="showTooltip(event, '時間がとれます：\\n「時間をとる」（抽出时间）的能动态的ます形，表示能够腾出、抽出时间。')">時間がとれます</span>けど。`, translation: "（如果是星期二下午的话，我可以抽出时间。）", correct: true }
    ]
},
{
    id: 2,
    audio: "audio_j/2010.12-2.mp3",
    image: "image/2010.12-2.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">この間のキャンプ、一緒に来<span class="keyword" onclick="showTooltip(event, 'たらよかったのに：\\n表示与过去事实相反的遗憾心情，意为“要是……就好了（可是却没有）”。')">たらよかったのに</span>。</span>`,
    translation: "（上次露营，你要是一起去就好了。）",
    options: [
        { text: `<span class="keyword" onclick="showTooltip(event, 'どうしよう：\\n「どうする」的意志形，表示面临选择或困境时的思考和犹豫，意思是“该怎么办呢”。')">どうしよう</span>かな。`, translation: "（该怎么办呢？）", correct: false },
        { text: `行きたかった<span class="keyword" onclick="showTooltip(event, 'んだけど：\\n「ん」是「の」的口语形式，用于说明情况或解释原因；「だけど」起铺垫或委婉转折的作用。合起来用于表达自己原本想去，但因故没去成的无奈与遗憾。')">んだけど</span>ね。`, translation: "（我本来也很想去的。）", correct: true },
        { text: "おもしろかったね。", translation: "（真的很好玩呢。）", correct: false }
    ]
},
{
    id: 3,
    audio: "audio_j/2010.12-3.mp3",
    image: "image/2010.12-3.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">来るの遅いよ。<span class="keyword" onclick="showTooltip(event, 'もう：\\n副词，在这里结合语境表示事物达到了某种紧迫的状态，意思是“已经”。')">もう</span>時間<span class="keyword" onclick="showTooltip(event, 'ぎりぎり：\\n副词，表示“勉勉强强”、“极限”，指时间刚好来得及，没有任何余地。')">ぎりぎり</span>だよ。</span>`,
    translation: "（你来得太晚了，都快赶不上时间了。）",
    options: [
        { text: "また遅れちゃったの?", translation: "（又迟到了吗？）", correct: false },
        { text: `<span class="keyword" onclick="showTooltip(event, 'あと：\\n表示剩余的时间或数量，意思是“还剩下……”、“还有……”。')">あと</span>10分だけだよ。`, translation: "（只剩 10 分钟了。）", correct: false },
        { text: "ごめんね、寝坊しちゃって。", translation: "（对不起，睡过头了。）", correct: true }
    ]
},
{
    id: 4,
    audio: "audio_j/2010.12-4.mp3",
    image: "image/2010.12-4.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">山田さん、社長が<span class="keyword" onclick="showTooltip(event, 'お呼びです：\\n「お＋动词第一连用形＋です」构成的尊他语，表示对动作主体（社长）的尊敬。这里指“社长在找（你）”。')">お呼びです</span>よ。</span>`,
    translation: "（山田，社长有事找你。）",
    options: [
        { text: `すぐ<span class="keyword" onclick="showTooltip(event, '伺います：\\n动词「伺う」的ます形，是「行く」的自谦语。通过降低自己的动作来表示对对方的尊敬，这里意思是“我去”。')">伺います</span>。`, translation: "（我马上过去。）", correct: true },
        { text: `こちらに<span class="keyword" onclick="showTooltip(event, 'おいで：\\n「来る」等动词的尊他语名词形式。结合「ください」构成「おいでください」，表示尊敬地请求对方过来。')">おいで</span>ください。`, translation: "（请到这边来。）", correct: false },
        { text: "お待ちいたします。", translation: "（我在这里等候。）", correct: false }
    ]
},
{
    id: 5,
    audio: "audio_j/2010.12-5.mp3",
    image: "image/2010.12-5.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">今日はどこもすごい<span class="keyword" onclick="showTooltip(event, '人ごみ：\\n名词，表示“人群”、“人山人海”。')">人ごみ</span>だね。</span>`,
    translation: "（今天到处都挤满了人啊。）",
    options: [
        { text: "お祭りだからね。", translation: "（因为今天在办祭典嘛。）", correct: true },
        { text: "あっ、ちょっと多すぎちゃった?", translation: "（哎，是不是人太多了？）", correct: false },
        { text: "もう捨ててきたよ。", translation: "（我已经扔掉了。）", correct: false }
    ]
},
{
    id: 6,
    audio: "audio_j/2010.12-6.mp3",
    image: "image/2010.12-6.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">この資料、今日中にコピーし<span class="keyword" onclick="showTooltip(event, 'てもらえると助かる：\\n「てもらえる」是「てもらう」的能动态，表示“能得到（别人为自己做某事）”。接上表示条件的「と」和「助かる」，意思是“如果能（帮我）……的话就帮大忙了”，是职场中委婉拜托别人的常用句型。')">てもらえると助かる</span>んだけど。</span>`,
    translation: "（这些资料如果今天之内能复印好就帮大忙了。）",
    options: [
        { text: "はい、お願いします。", translation: "（拜托您了。）", correct: false },
        { text: "遅くなりますが、いいでしょうか。", translation: "（可能会晚一点，可以吗？）", correct: true },
        { text: `それは<span class="keyword" onclick="showTooltip(event, 'ありがたい：\\n形容词，表示“值得感谢的”、“难得的”。通常用于自己接受了别人的好意或恩惠时表达感激之情，在此处作为被拜托的一方使用不符合语境。')">ありがたい</span>です。`, translation: "（那真是太好了。）", correct: false }
    ]
},
{
    id: 7,
    audio: "audio_j/2010.12-7.mp3",
    image: "image/2010.12-7.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">こちらにお名前とご住所を<span class="keyword" onclick="showTooltip(event, 'ご〜いただけますか：\\n「ご＋汉字词汇＋いただく」的能动态形式，加上疑问词「か」，表示非常礼貌地请求对方做某事，意思是“能请您……吗”。')">ご記入いただけますか</span>。</span>`,
    translation: "（请在这里填写您的姓名和住址。）",
    options: [
        { text: `どなたに伺えば<span class="keyword" onclick="showTooltip(event, 'よろしい：\\n形容词「いい」的郑重说法，表示“好”、“可以”。「よろしいですか」常用于向对方确认或询问，语气比「いいですか」更礼貌。')">よろしい</span>ですか?`, translation: "（我应该向谁请教呢？）", correct: false },
        { text: `<span class="keyword" onclick="showTooltip(event, '結構：\\n形容动词，根据语境可表示“足够”、“可以”，或用于婉拒别人，表示“不用了”。在这里作为回应填写表格的请求显得不自然。')">結構</span>です。お願いします。`, translation: "（这样就行了，麻烦你了。）", correct: false },
        { text: "あっ、すみません。ペンをお借りできますか。", translation: "（啊，不好意思，可以借我一支笔吗？）", correct: true }
    ]
},
{
    id: 8,
    audio: "audio_j/2010.12-8.mp3",
    image: "image/2010.12-8.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">ああ、<span class="keyword" onclick="showTooltip(event, 'しまった：\\n感叹词，表示突然发现做错了事或遇到了糟糕的情况，意思是“糟了”、“哎呀”。')">しまった</span>。うちに財布忘れてきちゃった。</span>`,
    translation: "（糟了，我把钱包忘在家里了。）",
    options: [
        { text: `鍵閉め<span class="keyword" onclick="showTooltip(event, 'なくちゃだめ：\\n「なくちゃ」是「なくては」的口语缩略形式，接在动词的「ない形」之后；「だめ」表示不行。合起来强调必须做某事，即“不做不行”。')">なくちゃだめ</span><span class="keyword" onclick="showTooltip(event, 'じゃない：\\n作为终助词放在句末，带有轻微责备或提醒对方的语气，意思是“不是……吗”、“你得……呀”。')">じゃない</span>。`, translation: "（门可得锁好啊。）", correct: false },
        { text: "大丈夫、貸そうか。", translation: "（没事吧，要不我借你点？）", correct: true },
        { text: `ヘ？<span class="keyword" onclick="showTooltip(event, '警察に届け：\\n动词「届ける」（送达、申报）。这里特指去警察局挂失或报案。')">警察に届け</span>なきゃ。`, translation: "（诶？那得去报警才行啊。）", correct: false }
    ]
},
{
    id: 9,
    audio: "audio_j/2010.12-9.mp3",
    image: "image/2010.12-9.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">この仕事の<span class="keyword" onclick="showTooltip(event, '締め切り：\\n名词，表示“截止”、“期限”。由动词「締め切る」的第一连用形转变而来。')">締め切り</span>って、来週の金曜日でした<span class="keyword" onclick="showTooltip(event, 'っけ：\\n终助词，多用于口语，接在句末，用于向对方确认自己记忆不清的事情或回想某事，意思是“……来着”、“……对吧”。')">っけ</span>。</span>`,
    translation: "（这项工作的截止日期是下周五，对吧？）",
    options: [
        { text: "来週からですよ。", translation: "（是从下周开始哦。）", correct: false },
        { text: "締め切りますよ。", translation: "（要截止了哦。）", correct: false },
        { text: "そのはずですけど。", translation: "（应该是的。）", correct: true }
    ]
},
{
    id: 10,
    audio: "audio_j/2010.12-10.mp3",
    image: "image/2010.12-10.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">その計画は予算を考えるとやめ<span class="keyword" onclick="showTooltip(event, 'ざるを得ない：\\n接在动词「ない形」去掉「ない」的形式之后（「する」变为「せ」），表示“不得不……”、“不能不……”。表示迫于某种情况，除此之外别无他法。')">ざるを得ない</span>なあ。</span>`,
    translation: "（考虑到预算的情况，这个计划不得不放弃了啊。）",
    options: [
        { text: "十分な予算ですからね。", translation: "（毕竟预算可是足够的。）", correct: false },
        { text: "じゃ、実行しましょう。", translation: "（那就实行吧。）", correct: false },
        { text: `ええ、<span class="keyword" onclick="showTooltip(event, '仕方ない：\\n形容词，意为“没办法”、“无奈”。表示对某种状况无能为力，只能接受。')">仕方ない</span>ですね。`, translation: "（是啊，没办法呢。）", correct: true }
    ]
},
{
    id: 11,
    audio: "audio_j/2010.12-11.mp3",
    image: "image/2010.12-11.png",
    dialogueHtml: `<span class="speaker-name">女：</span><span class="speaker-text">東京に<span class="keyword" onclick="showTooltip(event, 'いらして：\\n动词「いらっしゃる」的て形。「いらっしゃる」是「来る」或「いる」的尊他语，在这里表示来到并在东京居住。')">いらして</span>もう長いんですか。</span>`,
    translation: "（您在东京已经很久了吗？）",
    options: [
        { text: "あと3時間ぐらいでしょうか。", translation: "（还要大约3个小时吗？）", correct: false },
        { text: `いえ、3ヶ月前に来<span class="keyword" onclick="showTooltip(event, 'たばかり：\\n接在动词「た形」后，表示动作刚刚完成或发生不久，意思是“刚刚……”。')">たばかり</span>です。`, translation: "（不，我是三个月前刚来的。）", correct: true },
        { text: "まだ30キロぐらいあります。", translation: "（还有大约30公里。）", correct: false }
    ]
},
{
    id: 12,
    audio: "audio_j/2010.12-12.mp3",
    image: "image/2010.12-12.png",
    dialogueHtml: `<span class="speaker-name">男：</span><span class="speaker-text">課長に連絡が取れ<span class="keyword" onclick="showTooltip(event, '次第：\\n接在动词第一连用形（ます形去掉ます）之后，表示“一……就……”，强调在某个动作结束后立即进行下一个动作。')">次第</span>、<span class="keyword" onclick="showTooltip(event, '至急：\\n名词或副词，表示“火急”、“极其紧急”、“立刻”。')">至急</span>戻るように伝えて。</span>`,
    translation: "（和科长取得联系后，立即转告他赶快回来。）",
    options: [
        { text: "すぐ連絡します。", translation: "（我马上去联系。）", correct: true },
        { text: "今お返しします。", translation: "（我这就回复。）", correct: false },
        { text: "課長が戻ったら伝えます。", translation: "（等科长回来以后我会转告他的。）", correct: false }
    ]
}
                ]
            }
        };

        let currentExamKey = "2010-07";
        let currentQuestionIndex = 0;

        // --- Initialization ---
        function init() {
            // 1. Get Year from URL or default
            const urlParams = new URLSearchParams(window.location.search);
            const yearParam = urlParams.get('year');
            
            // Check if valid
            if (yearParam && examData[yearParam]) {
                currentExamKey = yearParam;
            } else {
                // Default to first key if not specified or invalid
                currentExamKey = Object.keys(examData)[0];
            }

            // 2. Set Year Label
            const yearLabel = document.getElementById('yearLabel');
            if (yearLabel) {
                yearLabel.textContent = examData[currentExamKey].label;
            }

            // 3. Populate Question Select
            updateQuestionSelect();

            // 4. Initial Render
            renderQuestion();
        }

        function updateQuestionSelect() {
            const select = document.getElementById('questionSelect');
            select.innerHTML = '';
            
            const questions = examData[currentExamKey].questions;
            questions.forEach((q, index) => {
                const option = document.createElement('option');
                option.value = index; // Use index as value for easier handling
                option.textContent = `問題 ${q.id}`;
                select.appendChild(option);
            });
        }

        function changeQuestion(index) {
            currentQuestionIndex = parseInt(index);
            renderQuestion();
        }

        function selectOption(element) {
            // Only active in practice mode
            const container = document.getElementById('appContainer');
            if (!container.classList.contains('mode-practice')) return;
            
            // Do not change selection if already judged
            if (element.parentElement.querySelector('.judged-correct') || element.parentElement.querySelector('.judged-wrong')) return;

            // Remove selected from siblings
            const siblings = element.parentElement.children;
            for (let i = 0; i < siblings.length; i++) {
                siblings[i].classList.remove('selected');
            }
            // Add to clicked
            element.classList.add('selected');
            
            // Show confirm button
            const confirmBtn = document.getElementById('confirmBtn');
            if(confirmBtn) confirmBtn.style.display = 'block';
        }

        function checkAnswer() {
            const container = document.getElementById('appContainer');
            const selected = container.querySelector('.options-list li.selected');
            if (!selected) return;
            
            container.classList.add('judged');
            
            const index = parseInt(selected.getAttribute('data-index'));
            const question = examData[currentExamKey].questions[currentQuestionIndex];
            const options = container.querySelectorAll('.options-list li');
            
            const isCorrect = question.options[index].correct;
            
            if (isCorrect) {
                selected.classList.add('judged-correct');
            } else {
                selected.classList.add('judged-wrong');
                // Show correct answer
                question.options.forEach((opt, i) => {
                    if (opt.correct) {
                        options[i].classList.add('judged-correct');
                    }
                });
            }
            
            // Hide confirm button
            document.getElementById('confirmBtn').style.display = 'none';
        }

        function prevQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                renderQuestion();
            }
        }

        function nextQuestion() {
            const questions = examData[currentExamKey].questions;
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                setMode('practice');
                renderQuestion();
            }
        }

        function renderQuestion() {
            const container = document.getElementById('appContainer');
            if (container) container.classList.remove('judged');

            const data = examData[currentExamKey].questions[currentQuestionIndex];
            const total = examData[currentExamKey].questions.length;

            // Update Select Box
            const select = document.getElementById('questionSelect');
            if (select) {
                select.value = currentQuestionIndex;
            }
            
            // Update Audio
            const audio = document.getElementById('audioElement');
            const wasPlaying = !audio.paused;
            // Only update src if changed to avoid reloading if not needed (though mostly it changes)
            if (!audio.src.endsWith(data.audio) && data.audio) {
                audio.src = data.audio;
                // Reset player state
                document.getElementById('progressBar').style.width = '0%';
                document.getElementById('timeDisplay').textContent = '00:00 / 00:00';
                document.getElementById('playBtn').innerHTML = playIcon;
            } else if (!data.audio) {
                audio.removeAttribute('src');
            }

            // Update Image
            const img = document.getElementById('sceneImage');
            if (data.image) {
                img.src = data.image;
                img.style.display = 'block';
            } else {
                img.style.display = 'none';
            }

            // Update Dialogue
            const dialogueBlock = document.getElementById('dialogueBlock');
            dialogueBlock.innerHTML = `
                <div class="dialogue-text">${data.dialogueHtml}</div>
                <div class="translation">${data.translation}</div>
            `;

            // Update Options
            const optionsList = document.getElementById('optionsList');
            optionsList.innerHTML = '';
            data.options.forEach((opt, idx) => {
                const li = document.createElement('li');
                if (opt.correct) li.classList.add('correct-answer');
                li.setAttribute('data-index', idx);
                
                // Add click handler for selection (Practice Mode)
                li.onclick = () => selectOption(li);

                li.innerHTML = `
                    <span class="options-num">${idx + 1}</span>
                    <div class="option-text">${opt.text}</div>
                    <div class="translation">${opt.translation}</div>
                `;
                optionsList.appendChild(li);
            });

            // Hide confirm button when rendering new question
            const confirmBtn = document.getElementById('confirmBtn');
            if(confirmBtn) confirmBtn.style.display = 'none';

            // Update Nav Buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 0;
            document.getElementById('nextBtn').disabled = currentQuestionIndex === total - 1;
        }

        // Audio Player Logic
        const audio = document.getElementById('audioElement');
        const playBtn = document.getElementById('playBtn');
        const progressBar = document.getElementById('progressBar');
        const progressContainer = document.getElementById('progressContainer');
        const timeDisplay = document.getElementById('timeDisplay');
        const playIcon = '<svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M13 7.13397C14.3333 7.90377 14.3333 9.82823 13 10.598L2.5 16.6603C1.16667 17.4301 -1.45707e-06 16.4678 -1.38973e-06 14.9282L-8.59795e-07 2.80385C-7.92455e-07 1.26425 1.16667 0.301995 2.5 1.0718L13 7.13397Z" fill="white"/></svg>';
        const pauseIcon = '<svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="3" y="2" width="3" height="12" rx="1.5" fill="white"/><rect x="8" y="2" width="3" height="12" rx="1.5" fill="white"/></svg>';

        playBtn.addEventListener('click', togglePlay);
        audio.addEventListener('timeupdate', updateProgress);
        progressContainer.addEventListener('click', setProgress);
        audio.addEventListener('loadedmetadata', () => {
            timeDisplay.textContent = `00:00 / ${formatTime(audio.duration)}`;
        });
        audio.addEventListener('ended', () => {
            playBtn.innerHTML = playIcon;
            progressBar.style.width = '0%';
        });

        function togglePlay() {
            if (audio.paused) {
                audio.play();
                playBtn.innerHTML = pauseIcon;
            } else {
                audio.pause();
                playBtn.innerHTML = playIcon;
            }
        }

        function updateProgress() {
            const { duration, currentTime } = audio;
            const progressPercent = (currentTime / duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
            timeDisplay.textContent = `${formatTime(currentTime)} / ${formatTime(duration || 0)}`;
        }

        function setProgress(e) {
            const width = this.clientWidth;
            const clickX = e.offsetX;
            const duration = audio.duration;
            audio.currentTime = (clickX / width) * duration;
        }

        function formatTime(seconds) {
            const min = Math.floor(seconds / 60);
            const sec = Math.floor(seconds % 60);
            return `${min.toString().padStart(2, '0')}:${sec.toString().padStart(2, '0')}`;
        }

        function setMode(mode) {
            const container = document.getElementById('appContainer');
            const btnPractice = document.getElementById('btnPractice');
            const btnExplanation = document.getElementById('btnExplanation');
            const tooltip = document.getElementById('wordTooltip');

            tooltip.style.display = 'none';

            if (mode === 'practice') {
                container.classList.remove('mode-explanation');
                container.classList.add('mode-practice');
                btnPractice.classList.add('active');
                btnExplanation.classList.remove('active');
            } else {
                container.classList.remove('mode-practice');
                container.classList.add('mode-explanation');
                btnExplanation.classList.add('active');
                btnPractice.classList.remove('active');
            }
        }

        function showTooltip(event, text) {
            event.stopPropagation();
            
            const tooltip = document.getElementById('wordTooltip');
            tooltip.innerText = text;
            tooltip.style.display = 'block';
            
            const targetRect = event.target.getBoundingClientRect();
            
            setTimeout(() => {
                const tooltipWidth = tooltip.offsetWidth;
                const tooltipHeight = tooltip.offsetHeight;
                
                const top = targetRect.top + window.scrollY - tooltipHeight - 10; 
                let left = targetRect.left + window.scrollX + (targetRect.width / 2) - (tooltipWidth / 2);
                
                // Prevent tooltip from going off-screen
                if (left < 10) left = 10;
                if (left + tooltipWidth > window.innerWidth - 10) {
                    left = window.innerWidth - tooltipWidth - 10;
                }

                // Adjust arrow position to point to the target
                const targetCenterX = targetRect.left + window.scrollX + (targetRect.width / 2);
                const arrowLeft = targetCenterX - left;
                tooltip.style.setProperty('--arrow-left', `${arrowLeft}px`);
                
                tooltip.style.top = `${top}px`;
                tooltip.style.left = `${left}px`;
            }, 0);
        }

        document.addEventListener('click', function() {
            const tooltip = document.getElementById('wordTooltip');
            if (tooltip.style.display === 'block') {
                tooltip.style.display = 'none';
            }
        });
        // Initialize on load
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
