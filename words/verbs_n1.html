<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N1 ÂãïË©û - ÂçòË™ûÊöóË®ò</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;500&display=swap');

        html {
            -webkit-text-size-adjust: 100%; /* Prevent font boosting on mobile */
        }

        :root {
            --bg-color: #fdfaf5;
            --paper-color: #ffffff;
            --text-color: #2c2c2c;
            --sub-color: #787878;
            --accent-color: #b33e3e;
            --n1-color: #e57373;
            --study-theme: var(--n1-color); /* N1 Theme */
            --shadow: rgba(0,0,0,0.08);
        }

        body {
            font-family: "Hiragino Sans", "Meiryo", "Microsoft YaHei", -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        /* Header */
        header {
            width: 100%;
            padding: 15px 20px;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: space-between; /* Changed for switch */
            position: sticky;
            top: 0;
            z-index: 100;
            background-color: rgba(253, 250, 245, 0.95);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }

        .back-btn {
            text-decoration: none;
            color: var(--text-color);
            font-size: 16px;
            font-weight: bold;
            opacity: 0.7;
            transition: opacity 0.3s;
            cursor: pointer;
        }
        .back-btn:hover { opacity: 1; }

        h1 { 
            margin: 0; 
            font-size: 18px; 
            font-weight: 700; 
            color: var(--study-theme);
            position: absolute; 
            left: 50%; 
            transform: translateX(-50%); 
        }

        /* Mode Switch */
        .mode-switch { display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: bold; color: var(--sub-color); }
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--study-theme); }
        input:checked + .slider:before { transform: translateX(20px); }

        /* Self-Check Mode Effects */
        .hide-target { transition: all 0.3s ease; border-radius: 4px; }
        
        body.test-mode .hide-target {
            filter: blur(6px);
            opacity: 0.3;
            background-color: #eee;
            color: transparent; /* Help hide text better */
            cursor: pointer;
            user-select: none;
        }
        
        body.test-mode .hide-target.revealed {
            filter: blur(0);
            opacity: 1;
            background-color: transparent;
            color: inherit;
        }

        /* Hide Furigana in Test Mode */
        body.test-mode rt { opacity: 0; transition: opacity 0.3s; }

        /* Container */
        .container {
            width: 95%;
            max-width: 600px;
            padding: 20px 0;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px; /* Space between cards */
        }

        /* --- Day Selection View --- */
        .days-grid {
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding: 10px;
        }

        /* Active Day Card (Figure 1 Style) */
        .day-card {
            background: #fff;
            border-radius: 16px;
            padding: 20px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            cursor: pointer;
            transition: all 0.2s;
            border: 1px solid rgba(0,0,0,0.02);
        }

        .day-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.06);
        }

        .day-card:active { transform: scale(0.99); }

        .day-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .day-icon {
            width: 44px; height: 44px;
            background: #f5f5f5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .day-text-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .day-title {
            font-size: 17px;
            font-weight: bold;
            color: var(--text-color);
            margin: 0;
        }

        .day-title-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .last-studied-badge {
            font-size: 10px;
            color: #fff;
            background-color: var(--accent-color);
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
            display: inline-block;
            vertical-align: middle;
        }

        .day-subtitle {
            font-size: 13px;
            color: var(--sub-color);
        }

        .go-badge {
            background: #f0f0f0;
            color: #888;
            font-size: 13px;
            font-weight: bold;
            padding: 6px 14px;
            border-radius: 20px;
        }

        /* Preparation/Empty Card (Figure 2 Style) */
        .day-card.prep {
            background: transparent;
            border: 1px dashed #ddd;
            box-shadow: none;
            cursor: default;
        }
        .day-card.prep:hover { transform: none; }

        .day-card.prep .day-icon {
            background: #eee;
            color: #aaa;
        }
        
        .day-card.prep .day-title { color: #999; }
        .day-card.prep .day-subtitle { color: #aaa; }
        
        .construction-icon {
            font-size: 24px;
            opacity: 0.5;
        }

        /* --- Word List View --- */
        .flashcard-container {
            position: relative;
            background: #ffffff;
            border-radius: 12px; /* Slightly smaller radius for list */
            box-shadow: 0 4px 15px var(--shadow);
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            width: 100%;
            overflow: hidden; /* Ensure content stays inside */
        }

        /* Top Face (Summary View) */
        .card-top-face {
            padding: 20px 25px; /* Compact padding */
            cursor: pointer;
            border-bottom: 1px solid transparent; /* Hidden by default */
            transition: background 0.2s, border-color 0.3s;
            display: flex;
            flex-direction: row; /* Horizontal layout for list */
            justify-content: space-between;
            align-items: center;
        }
        .card-top-face:active { background: #f9f9f9; }

        .word-info-group {
            display: flex;
            align-items: baseline;
            gap: 10px;
        }

        .main-word-display {
            font-size: 24px; /* Smaller for list */
            font-weight: bold;
            color: var(--text-color);
            margin: 0;
        }

        /* Expanded State */
        .flashcard-container.is-expanded .card-top-face {
            background: #fcfcfc;
            border-bottom: 1px solid #eee;
        }
        
        .flashcard-container.is-expanded .tap-hint { display: none; }

        /* Ruby & Tone */
        ruby { ruby-position: over; }
        rt { font-size: 0.5em; color: var(--study-theme); font-weight: normal; transform: translateY(-2px); }

        .tone-number {
            font-size: 14px;
            color: var(--study-theme);
            border: 1px solid var(--study-theme);
            border-radius: 4px;
            padding: 0 4px;
            font-weight: bold;
            margin-left: 5px;
            opacity: 1; /* Always visible in list */
        }

        /* POS Tag */
        .pos-tag {
            font-size: 12px;
            background: #ffebee;
            color: var(--study-theme);
            padding: 1px 6px;
            border-radius: 4px;
            margin-left: 5px;
            font-weight: bold;
            opacity: 1; /* Always visible in list */
        }

        /* Star Button */
        .star-btn {
            background: transparent; border: none; padding: 5px;
            cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }
        .star-icon {
            width: 24px; height: 24px;
            stroke: #e0e0e0; stroke-width: 2; fill: none;
            transition: all 0.3s;
        }
        .dog-btn {
            font-size: 28px;
            cursor: pointer;
            opacity: 0.3;
            filter: grayscale(100%);
            transition: all 0.3s;
            background: transparent;
            border: none;
            padding: 0;
            line-height: 1;
        }
        .dog-btn.active {
            opacity: 1;
            filter: none;
            transform: scale(1.1);
        }
        .dog-btn:hover {
            transform: scale(1.2);
        }

        .list-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .tap-hint { font-size: 12px; color: #bbb; margin-left: auto; white-space: nowrap; display: none; }

        /* Word List Directory Style */
        .word-list-item {
            background: #fff;
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.02);
            border: 1px solid rgba(0,0,0,0.03);
            transition: all 0.2s;
        }
        .word-list-item:hover { transform: translateX(5px); box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .list-word-text { font-size: 18px; font-weight: bold; color: var(--text-color); }
        .list-arrow { color: #ccc; font-size: 20px; }

        /* Full Screen Flashcard Style */
        .flashcard-main {
            background: #fff;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            min-height: 400px;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }
        .fc-header { border-bottom: 1px solid #eee; padding-bottom: 15px; }
        .fc-word-group { display: flex; align-items: baseline; gap: 12px; flex-wrap: wrap; }
        .fc-word { font-size: 32px; font-weight: bold; color: var(--text-color); margin: 0; line-height: 1.2; }
        .fc-meta { display: flex; gap: 8px; align-items: center; }
        .fc-section-title { font-size: 12px; color: var(--sub-color); font-weight: bold; margin-bottom: 6px; letter-spacing: 0.05em; }
        .fc-meaning { font-size: 20px; font-weight: bold; line-height: 1.6; color: #222; }
        .fc-nuance { font-size: 15px; color: #555; background: #f9f9f9; padding: 12px; border-radius: 8px; line-height: 1.7; border-left: 3px solid var(--accent-color); }
        
        .nav-controls { display: flex; justify-content: space-between; align-items: center; margin-top: 20px; }
        .nav-btn { background: #fff; border: 1px solid #ddd; padding: 10px 20px; border-radius: 30px; cursor: pointer; font-weight: bold; color: #666; transition: all 0.2s; display: flex; align-items: center; gap: 8px; }
        .nav-btn:hover { background: #f5f5f5; color: #333; }
        .nav-btn.primary { background: var(--study-theme); color: #fff; border-color: var(--study-theme); }
        .nav-btn.primary:hover { opacity: 0.9; }
        .nav-btn.disabled { opacity: 0.3; pointer-events: none; }
        
        /* Example Styles override for Flashcard */
        .fc-content .example-list { border-top: none; padding-top: 0; margin-top: 5px; }


        /* Examples */
        .example-list { margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
        .example-item { margin-bottom: 12px; }
        .ex-jp { 
            font-size: 15px; 
            color: #333; 
            font-weight: normal; 
            margin-bottom: 2px; 
            line-height: 2;
            font-family: "Hiragino Sans", "Hiragino Kaku Gothic ProN", "Noto Sans JP", "Meiryo", sans-serif;
        }
        .ex-cn { font-size: 13px; color: #777; }
        .ex-jp ruby { font-size: inherit; }
        .ex-jp rt { font-size: 0.6em; user-select: none; }
        .ex-highlight { 
            font-weight: bold; 
            color: var(--text-color);
            font-size: inherit;
            font-family: inherit;
        }

        .hidden { display: none !important; }

        /* Definition Styles (Replaces inline styles for better control) */
        .def-number {
            color: var(--study-theme);
            font-weight: bold;
            font-size: 1.2em;
            margin-right: 8px;
        }
        .def-meaning {
            font-weight: bold;
            color: #333;
            font-size: 1.1em;
        }
        .def-nuance {
            color: #666;
            margin-left: 8px;
            font-weight: normal;
        }

        /* Mobile Responsive Adjustments */
        @media (max-width: 480px) {
            .container {
                padding: 10px 0;
            }
            
            .flashcard-main {
                padding: 20px;
                border-radius: 12px;
            }
            
            .fc-word {
                font-size: 24px !important; /* Override inline style */
            }
            
            .fc-meaning {
                font-size: 17px;
            }
            
            .fc-nuance {
                font-size: 13px;
                padding: 10px;
            }
            
            .ex-jp {
                font-size: 14px;
            }
            
            /* Example Translation */
            .def-ex .hide-target {
                font-size: 12px !important;
            }

            /* Example Label */
            .def-ex span:first-child {
                font-size: 12px !important;
            }
            
            .day-card {
                padding: 15px;
            }
            
            .day-title {
                font-size: 15px;
            }
            
            .list-word-text {
                font-size: 16px;
            }

            /* Definition Text Adjustment */
            .def-meaning {
                font-size: 16px; /* Reduced from 1.1em (~17.6px) */
            }
            .def-number {
                font-size: 16px;
            }
            .def-nuance {
                font-size: 14px;
                margin-left: 4px;
            }
        }
    </style>
</head>
<body>

    <header>
        <a id="back-btn" class="back-btn">‚Üê Êàª„Çã</a>
        <h1 id="page-title">N1 ÂãïË©û</h1>
        <div class="mode-switch">
            <label for="testModeToggle">Ëá™Ê£Ä</label>
            <label class="switch">
                <input type="checkbox" id="testModeToggle">
                <span class="slider"></span>
            </label>
        </div>
    </header>

    <div class="container">
        <!-- View 1: Day Selection List -->
        <div id="days-view" class="days-grid">
            <!-- Injected by JS -->
        </div>

        <!-- View 2: Word List (Directory) -->
        <div id="word-list-view" class="hidden">
            <div id="word-list-container" style="display: flex; flex-direction: column; gap: 10px;">
                <!-- Injected by JS -->
            </div>
        </div>

        <!-- View 3: Word Detail (Flashcard) -->
        <div id="word-detail-view" class="hidden">
            <!-- Injected by JS -->
        </div>
    </div>

    <script src="n1_verbs_data.js"></script>
    <script>
        // --- Data ---
        // Data is now loaded from n1_verbs_data.js


        // --- State ---
        let currentView = 'days'; // 'days', 'list', 'detail'
        let currentDay = 1;
        let currentDailyWords = [];
        let currentWordIndex = 0;

        // --- Logic ---

        // 1. Render Days Grid
        function renderDays() {
            const container = document.getElementById('days-view');
            container.innerHTML = '';

            // Get last studied day (Safe access)
            let lastDay = 0;
            try {
                lastDay = parseInt(localStorage.getItem('n1_verbs_last_day')) || 0;
            } catch (e) {
                console.warn('LocalStorage access denied', e);
            }

            // Render active days
            for (let i = 1; i <= TOTAL_DAYS; i++) {
                const dayCard = document.createElement('div');
                dayCard.className = 'day-card';
                
                let badgeHtml = '';
                if (i === lastDay) {
                    badgeHtml = `<span class="last-studied-badge">ÂâçÂõû</span>`;
                }
                
                dayCard.innerHTML = `
                    <div class="day-info">
                        <div class="day-icon">üìÖ</div>
                        <div class="day-text-group">
                            <div class="day-title-row">
                                <div class="day-title">${i}Êó•ÁõÆ</div>
                                ${badgeHtml}
                            </div>
                            <div class="day-subtitle">${WORDS_PER_DAY}Ë™û ‚Ä¢ ÂèéÈå≤Ê∏à„Åø</div>
                        </div>
                    </div>
                    <div class="go-badge">Go</div>
                `;
                dayCard.onclick = () => selectDay(i);
                container.appendChild(dayCard);
            }

            // Render a "Preparation" card (Figure 2 Style)
            const prepCard = document.createElement('div');
            prepCard.className = 'day-card prep';
            prepCard.innerHTML = `
                <div class="day-info">
                    <div class="day-text-group">
                        <div style="margin-bottom:6px;">
                            <span style="background:#cfd8dc; color:#fff; font-size:11px; padding:2px 6px; border-radius:4px;">ËøΩÂä†‰∫àÂÆö</span>
                        </div>
                        <div class="day-title">16Êó•ÁõÆ‰ª•Èôç (Ê∫ñÂÇô‰∏≠)</div>
                        <div class="day-subtitle" style="margin-top:4px;">ÁèæÂú®„ÄÅ„Éá„Éº„Çø„ÅÆ‰ΩúÊàê„Å®Á¢∫Ë™ç„ÇíË°å„Å£„Å¶„ÅÑ„Åæ„Åô„ÄÇ</div>
                    </div>
                </div>
                <div class="construction-icon">üöß</div>
            `;
            container.appendChild(prepCard);
        }

        // 2. Select Day & Render Directory List
        function selectDay(day) {
            // Save last studied day (Safe access)
            try {
                localStorage.setItem('n1_verbs_last_day', day);
            } catch (e) {
                console.warn('LocalStorage access denied', e);
            }

            currentDay = day;
            currentView = 'list';
            
            // Calculate slice
            const start = (day - 1) * WORDS_PER_DAY;
            const end = start + WORDS_PER_DAY;
            currentDailyWords = FULL_WORD_LIST.slice(start, end);

            renderWordList(currentDailyWords);
            updateUI();
        }

        // 3. Render Word List (Directory Style)
        function renderWordList(words) {
            const container = document.getElementById('word-list-container');
            container.innerHTML = '';

            words.forEach((wordData, index) => {
                const item = document.createElement('div');
                item.className = 'word-list-item';
                
                const wordId = wordData.word;
                const isStarred = localStorage.getItem(`n1_verbs_star_${wordId}`) === 'true';
                const activeClass = isStarred ? 'active' : '';

                item.innerHTML = `
                    <div class="list-word-text">${wordData.word_html || wordData.word}</div>
                    <div class="list-actions">
                        <div class="dog-btn ${activeClass}" data-word="${wordId}">üê∂</div>
                        <div class="list-arrow">‚Ä∫</div>
                    </div>
                `;
                
                item.onclick = (e) => {
                    const btn = e.target.closest('.dog-btn');
                    if (btn) {
                        e.stopPropagation();
                        toggleDog(btn, wordId);
                        return;
                    }
                    openWordDetail(index);
                };
                container.appendChild(item);
            });
            
            window.scrollTo(0, 0);
        }

        function toggleDog(btn, wordId) {
            const key = `n1_verbs_star_${wordId}`;
            const isActive = localStorage.getItem(key) === 'true';
            
            if (isActive) {
                localStorage.removeItem(key);
                btn.classList.remove('active');
            } else {
                localStorage.setItem(key, 'true');
                btn.classList.add('active');
            }
        }

        // 4. Open Word Detail (Flashcard)
        function openWordDetail(index) {
            currentWordIndex = index;
            currentView = 'detail';
            renderDetailCard();
            updateUI();
        }

        // 5. Render Detail Card
        function renderDetailCard() {
            const container = document.getElementById('word-detail-view');
            const wordData = currentDailyWords[currentWordIndex];
            
            if (!wordData) return;

            // Tone and POS
            const toneHtml = wordData.tone ? `<span class="tone-number">${wordData.tone}</span>` : '';
            const posHtml = wordData.pos ? `<span class="pos-tag">${wordData.pos}</span>` : '';

            // Parse Meanings and Nuances
            // Split by Chinese/English semicolon or just use the whole string if no separator found
            let meanings = wordData.mean ? wordData.mean.split(/[Ôºõ;]/).map(s => s.trim()).filter(s => s) : [];
            
            let nuances = [];
            if (wordData.nuance) {
                // Remove numbering like "1. ", "2. "
                nuances = wordData.nuance.split('\n')
                    .map(line => line.trim().replace(/^\d+\.\s*/, ''))
                    .filter(line => line !== '');
            }
            
            // Examples
            let examples = wordData.examples || [];

            // Determine the number of definition blocks
            // Use the maximum length to ensure we show all available info
            const count = Math.max(meanings.length, nuances.length, examples.length);
            
            const numbers = ['‚ù∂', '‚ù∑', '‚ù∏', '‚ùπ', '‚ù∫', '‚ùª', '‚ùº', '‚ùΩ', '‚ùæ', '‚ùø'];
            
            let definitionsHtml = '';
            
            for (let i = 0; i < count; i++) {
                const num = numbers[i] || (i + 1) + '.';
                
                // Logic to handle mismatch in array lengths
                let meanText = meanings[i] || '';
                if (meanings.length === 1 && count > 1 && i > 0) {
                    meanText = ''; // Don't repeat summary if it's the only one
                }
                
                const nuanceText = nuances[i] || '';
                const ex = examples[i];
                
                // Add separator style for all except the last item
                const isLastItem = i === count - 1;
                const groupStyle = isLastItem ? 'margin-bottom: 0;' : 'margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px dashed #eee;';

                definitionsHtml += `<div class="def-group" style="${groupStyle}">`;
                
                // Header: Number + Meaning + (Nuance)
                // Only show header if there is meaning or nuance
                if (meanText || nuanceText) {
                    definitionsHtml += `<div class="def-header" style="margin-bottom: 8px; line-height: 1.6;">
                        <span class="def-number">${num}</span>
                        ${meanText ? `<span class="hide-target def-meaning">${meanText}</span>` : ''}
                        ${nuanceText ? `<span class="hide-target def-nuance">Ôºà${nuanceText}Ôºâ</span>` : ''}
                    </div>`;
                }
                
                // Example
                if (ex) {
                    definitionsHtml += `<div class="def-ex" style="margin-top: 8px; display: flex; align-items: baseline;">
                        <span style="color: #888; font-size: 0.9em; margin-right: 8px; user-select: none; flex-shrink: 0;">‰æãÂè•Ôºö</span>
                        <div style="flex: 1;">
                            <div class="ex-jp" lang="ja" style="font-weight: 500; color: #333; margin-bottom: 4px;">${ex.jp}</div>
                            <div class="hide-target" style="color: #888; font-size: 0.9em;">Ôºà${ex.cn}Ôºâ</div>
                        </div>
                    </div>`;
                }
                
                definitionsHtml += `</div>`;
            }

            // Navigation State
            const isFirst = currentWordIndex === 0;
            const isLast = currentWordIndex === currentDailyWords.length - 1;

            const wordId = wordData.word;
            const isStarred = localStorage.getItem(`n1_verbs_star_${wordId}`) === 'true';
            const activeClass = isStarred ? 'active' : '';

            container.innerHTML = `
                <div class="flashcard-main" style="padding: 20px 20px 40px; gap: 0;">
                    <div class="fc-header" style="margin-bottom: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: flex-start;">
                        <div class="fc-word-group" style="display: flex; align-items: baseline; gap: 10px;">
                            <div class="fc-word" style="font-size: 2.2em; font-weight: bold; color: var(--text-color);">${wordData.word_html || wordData.word}</div>
                            <div class="fc-meta" style="display: flex; align-items: center;">
                                ${toneHtml}
                                ${posHtml}
                            </div>
                        </div>
                        <div class="dog-btn ${activeClass}" onclick="toggleDog(this, '${wordId}')">üê∂</div>
                    </div>

                    <div class="fc-section-title" style="margin-top: 10px; margin-bottom: 5px; text-align: left; width: 100%;">Ëß£Ë™¨„Éª‰æãÊñá</div>

                    <div class="fc-content" style="padding-top: 5px;">
                        ${definitionsHtml}
                    </div>
                </div>

                <div class="nav-controls">
                    <button class="nav-btn ${isFirst ? 'disabled' : ''}" onclick="navigateWord(-1)">
                        <span>‚Üê</span> Ââç„Å∏
                    </button>
                    <div style="font-size:14px; color:#999;">${currentWordIndex + 1} / ${currentDailyWords.length}</div>
                    <button class="nav-btn primary ${isLast ? 'practice-btn' : ''}" onclick="${isLast ? `startPractice(${currentDay})` : 'navigateWord(1)'}">
                        ${isLast ? 'ÁªÉ‰π† <span>‚Üí</span>' : 'Ê¨°„Å∏ <span>‚Üí</span>'}
                    </button>
                </div>
            `;
            
            window.scrollTo(0, 0);
        }

        function navigateWord(direction) {
            const newIndex = currentWordIndex + direction;
            if (newIndex >= 0 && newIndex < currentDailyWords.length) {
                currentWordIndex = newIndex;
                renderDetailCard();
            }
        }

        function startPractice(day) {
            window.location.href = `practice_n1_verbs.html?day=${day}`;
        }

        // 6. UI Update (View Switching)
        function updateUI() {
            const daysView = document.getElementById('days-view');
            const wordListView = document.getElementById('word-list-view');
            const wordDetailView = document.getElementById('word-detail-view');
            const title = document.getElementById('page-title');
            const backBtn = document.getElementById('back-btn');
            const modeSwitch = document.querySelector('.mode-switch');

            // Reset all
            daysView.classList.add('hidden');
            wordListView.classList.add('hidden');
            wordDetailView.classList.add('hidden');
            
            // Show mode switch in list and detail views, hide in days view
            if (modeSwitch) {
                modeSwitch.style.display = currentView === 'days' ? 'none' : 'flex';
            }

            if (currentView === 'days') {
                daysView.classList.remove('hidden');
                title.textContent = 'N1 ÂãïË©û (15Êó•Èñì)';
                backBtn.onclick = () => window.location.href = '../vocabulary.html?level=N1';
                backBtn.innerHTML = '‚Üê Êàª„Çã';
            } else if (currentView === 'list') {
                wordListView.classList.remove('hidden');
                title.textContent = `${currentDay}Êó•ÁõÆ`;
                // Refresh list to show updated dog status
                if (currentDailyWords.length > 0) {
                    renderWordList(currentDailyWords);
                }
                
                backBtn.onclick = () => {
                    currentView = 'days';
                    updateUI();
                };
                backBtn.innerHTML = '‚Üê Êó•Êï∞ÈÅ∏Êäû';
            } else if (currentView === 'detail') {
                wordDetailView.classList.remove('hidden');
                title.textContent = 'ÂçòË™ûË©≥Á¥∞';
                backBtn.onclick = () => {
                    currentView = 'list';
                    updateUI();
                };
                backBtn.innerHTML = '‚Üê „É™„Çπ„Éà';
            }
        }

        // Initialize
        renderDays();
        updateUI();

        // --- Self-Check Mode Logic ---
        const toggleSwitch = document.getElementById('testModeToggle');
        
        toggleSwitch.addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('test-mode');
                // Reset all revealed targets when mode is enabled
                document.querySelectorAll('.hide-target').forEach(el => el.classList.remove('revealed'));
            } else {
                document.body.classList.remove('test-mode');
            }
        });

        // Event delegation for dynamically created hide-targets
        document.addEventListener('click', function(e) {
            if (document.body.classList.contains('test-mode')) {
                const target = e.target.closest('.hide-target');
                if (target) {
                    target.classList.toggle('revealed');
                }
            }
        });

    </script>
</body>
</html>
